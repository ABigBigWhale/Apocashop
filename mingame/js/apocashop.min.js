!function(){function e(e){this.loadState={preload:function(){e.add.text(1e3,1e3,"fix",{font:"1px yoster_islandregular",fill:"#FFFFFF"}),e.stage.backgroundColor="#92CD9A",e.input.mouse.capture=!0,e.displayManager=new r(e),e.assetManager=new i(e),e.reset=new d,e.displayManager.prepareStage(),e.assetManager.load()},create:function(){e.state.start("state_start")}}}function t(e){this.startState={create:function(){e.displayManager.putLoadingBackground(),e.displayManager.prepareStage(),e.displayManager.putTitleScreen(),e.input.onDown.add(function(){y("STARTING state_play"),e.state.start("state_play")})}}}function o(e){var t,o,n;this.playState={create:function(){function a(t){V.visible=t,K.visible=t,e.tutorial.questionVisible&&(Q.visible=t),X.visible=!t}function r(e){V.inputEnabled=e,K.inputEnabled=e,Q.inputEnabled=e,X.inputEnabled=e}function i(){Z.x=100,Z.y=75,Z.start(!0,4e3,null,50),Z.x=e.width-100,Z.y=75,Z.start(!0,4e3,null,50)}function s(t){for(var o=0;o<e.clockUI.length;o++)e.clockUI[o].tint=t}function d(t){e.displayManager.tintClouds(t),e.dialog.main.box.tint=t,_.setAll("tint",t),ie.tint=t,R.tint=t,C.setAll("tint",t),e.uiItemGroup.setAll("tint",t),e.depthGroups.titleGroup.setAll("tint",t),e.depthGroups.envGroup.setAll("tint",t),e.displayManager.imgBackgroundSky.setAll("tint",t),e.depthGroups.dialogGroup.setAll("tint",t);for(var o=0;o<e.depthGroups.dialogGroup.children.length;o++)void 0!=e.depthGroups.dialogGroup.children[o].children&&e.depthGroups.dialogGroup.children[o].setAll("tint",t);e.depthGroups.shopGroup.setAll("tint",t),e.depthGroups.questionGroup.setAll("tint",t),e.depthGroups.uiGroup.setAll("tint",t),A.setAll("tint",t),P.setAll("tint",t),G.setAll("tint",t),N.setAll("tint",t)}function l(t,o){for(var n=o[$]||["time"],a=0;a<n.length;a++){var r=e.add.button(e.world.centerX,e.world.centerY+100,"upgrade_"+n[a],u,this,1,0,0);r.x-=(r.width+10)*n.length/2-(r.width+10)*a,r.y-=r.height/2,r.nextVisual="shop_"+(te[n[a]][oe]||te[n[a]][te[n[a]].length-1]).name,r.nextPos=(te[n[a]][oe]||te[n[a]][te[n[a]].length-1]).position,r.visible=!0,r.inputEnabled=!0,r.descText=e.add.text(r.x+65-200,r.y+120,(te[n[a]][oe]||te[n[a]][te[n[a]].length-1]).effect+"\n\n"+(te[n[a]][oe]||te[n[a]][te[n[a]].length-1]).description,{font:"20px yoster_islandregular",fill:"#d3af7a",wordWrap:!0,wordWrapWidth:400,align:"center"}),r.descText.visible=!1,r.events.onInputOver.add(function(e){e.descText.visible=!0},r),r.events.onInputOut.add(function(e){e.descText.visible=!1},r),ne.add(r.descText),ne.add(r)}$++}function u(t,o){e.eventManager.notify(e.Events.LEVEL.ACCEPT,t.key),t.key.indexOf("shop")>0&&(p.kill(),p=e.add.sprite(t.nextPos[0],t.nextPos[1],t.nextVisual),p.smoothed=!1,p.alpha=1,p.visible=!0,e.depthGroups.shopGroup.add(p),oe++),Z.x=t.x+t.width/2,Z.y=t.y+t.height/2,Z.start(!0,1e3,null,15),f(!1)}function f(t){r(!t),t?(i(),ne=e.add.group(),l(ne,ee),d(1644825),e.dayTimer.pause()):(d(16777215),e.dayTimer.resume(),ne.visible=!1,ne.callAll("kill")),ae.visible=t}function c(e){re.clear(),re.lineStyle(1,5060396,1),re.beginFill(16777162,.5),re.drawRect(re.startx,re.starty,re.barwidth*e,re.barheight)}function h(e){for(var t="",o=0;o<e.length;o++)""!==e[o]&&(t+="> "+e[o]+"\n");return t}Phaser.Canvas.setImageRenderingCrisp(this.game.canvas),e.depthGroups={titleGroup:e.add.group(),envGroup:e.add.group(),dialogGroup:e.add.group(),shopGroup:e.add.group(),pedestGroup:e.add.group(),noteGroup:e.add.group(),questionGroup:e.add.group(),uiGroup:e.add.group(),frontGroup:e.add.group()},e.displayManager.putEnvironment();var p=e.displayManager.shop,g={};e.uiItemGroup=e.add.group();var m=function(t,o){for(var n=0;t>n;n++){var a=e.uiItemGroup.create(20,40+50*n,"ui_itemslot");a.anchor.setTo(0,0)}var r=-1;for(var i in o){r++;var s=e.uiItemGroup.create(24,44+50*r,"item_"+i);s.scale.setTo(2,2),s.smoothed=!1;var d=e.add.text(74,46+50*r,o[i],{font:"20px yoster_islandregular",fill:"#d3af7a"},e.uiItemGroup);y("UI: itemKey "+i+"\nUI: itemCount "+o[i]),g[i]=d}};e.depthGroups.uiGroup.add(e.uiItemGroup);var v={x:223,y:328};t=e.add.sprite(v.x+6,v.y+32,"ui_funnel_sand_top"),o=e.add.sprite(v.x+6,v.y+62,"ui_funnel_sand_buttom"),t.anchor.setTo(0,1),o.anchor.setTo(0,1);var w=new Phaser.Rectangle(0,0,t.width,t.height),b=new Phaser.Rectangle(0,o.height,o.width,0),T=e.add.sprite(v.x,v.y,"ui_funnel"),I=t.height,k=o.height;n=function(e){w.y=Math.round((1-e)*I),w.height=Math.round(e*I),b.y=Math.round(e*k),b.height=Math.round((1-e)*k)},t.crop(w),o.crop(b),e.clockUI=[T,t,o],e.depthGroups.uiGroup.add(t),e.depthGroups.uiGroup.add(o),e.depthGroups.uiGroup.add(T),t.visible=!1,o.visible=!1,T.visible=!1;var _=e.add.group();_.y=400;var E=_.create(800,400,"ui_note_big");E.smoothed=!1,E.anchor.setTo(1,1);var x=e.add.sprite(0,0);x.width=800,x.height=600,x.visible=!1;var O=e.add.text(240,50,"HELLO THERE",{font:"18px yoster_islandregular",fill:"#4d372c",wordWrap:!0,wordWrapWidth:250});_.add(O);var M=e.add.text(525,50,"HELLO THERE",{font:"18px yoster_islandregular",fill:"#4d372c",wordWrap:!0,wordWrapWidth:250});_.add(M);var S=!1;e.depthGroups.noteGroup.add(_),e.depthGroups.noteGroup.add(x);var C=e.add.group();e.depthGroups.uiGroup.add(C);var A=e.add.group(),P=e.add.group(),G=e.add.group(),N=e.add.group();e.depthGroups.uiGroup.add(A),e.depthGroups.uiGroup.add(P),e.depthGroups.uiGroup.add(G),e.depthGroups.uiGroup.add(N);var D=N.create(800,600,"ui_dialog"),R=A.create(0,600,"ui_table_background"),L=G.create(0,600,"ui_table");D.anchor.setTo(1,1),L.anchor.setTo(0,1),R.anchor.setTo(0,1);var H=G.create(145,600,"ui_note"),F=function(){y("UI: note clicked; shown: "+S),1!=H.alpha&&(H.fadeIn.stop(),H.shake.stop(),H.alpha=1);var t,o;S?(t=e.add.tween(_.position).to({y:400},300,Phaser.Easing.Quadratic.Out),o=e.add.tween(H).to({y:520},200,Phaser.Easing.Quadratic.Out),x.visible=!1):(t=e.add.tween(_.position).to({y:0},200,Phaser.Easing.Quadratic.In),o=e.add.tween(H).to({y:700},300,Phaser.Easing.Quadratic.Out),x.visible=!0),t.start(),o.start(),S=!S};H.inputEnabled=!0,x.inputEnabled=!0,H.events.onInputDown.add(F,this),x.events.onInputDown.add(F,this);var U=e.add.text(60,540,"0",{font:"30px yoster_islandregular",fill:"#ebc36f"});e.depthGroups.uiGroup.add(U);var Y=function(t){for(var o=e.add.group(),n=0;t>n;n++)o.create(20+50*Math.random(),450+30*Math.random(),"ui_coin");var a=e.add.tween(o.position).to({y:o.y+100},800,Phaser.Easing.Quadratic.Out),r=e.add.tween(o).to({alpha:0},500);r.onComplete.add(function(){o.destroy()}),a.start(),r.start()},z=function(){e.dialog.main.isPrinting?e.dialogManager.jumpMain():e.eventManager.notify(e.Events.INPUT.YES)},q=function(){e.dialog.main.isPrinting?e.dialogManager.jumpMain():e.eventManager.notify(e.Events.INPUT.NO)},B=function(){e.dialog.main.isPrinting?e.dialogManager.jumpMain():e.eventManager.notify(e.Events.INPUT.CONTINUE)},J=function(){1!=Q.alpha&&(Q.fadeIn.stop(),Q.alpha=1),e.analytics.track("question","toggled"),e.questionManager.toggleQuestions()},V=e.add.button(660,420,"ui_button_accept",z,this,1,0,2),K=e.add.button(660,480,"ui_button_reject",q,this,1,0,2),Q=e.add.button(800,540,"ui_button_question",J,this,1,0,2),X=e.add.button(660,440,"ui_button_continue",B,this,1,0,2);e.depthGroups.uiGroup.add(V),e.depthGroups.uiGroup.add(K),e.depthGroups.uiGroup.add(Q),e.depthGroups.uiGroup.add(X),V.scale.setTo(2,2),K.scale.setTo(2,2),Q.scale.setTo(2,2),Q.alpha=0,Q.fadeIn=e.add.tween(Q).to({alpha:.9},500,Phaser.Easing.Linear.None,!1,0,1e3,!0),Q.dragIn=e.add.tween(Q).to({x:660},500,Phaser.Easing.Linear.None,!1),V.smoothed=!1,K.smoothed=!1,Q.smoothed=!1;var Z=e.add.emitter(0,0,200);Z.makeParticles("ui_coin"),Z.gravity=130;var $=0,oe=0,ne=e.add.group(),ae=e.add.sprite(e.world.centerX,20,"ui_levelup");ae.scale.setTo(.75,.75),ae.x-=ae.width/2-12,ae.visible=!1;var re=e.add.graphics(15,e.height/2-6);e.depthGroups.uiGroup.add(re),re.lineStyle(1,5060396,1),re.beginFill(16777162,.5),re.startx=re.x,re.starty=re.y,re.currwidth=0,re.barwidth=162,re.barheight=9,re.drawRect(re.startx,re.starty,2,re.barheight);var ie,se,de,le,ue=function(){se=e.add.tween(ie).from({x:ie.x-300,y:ie.y+300},550,Phaser.Easing.Quadratic.Out),de=e.add.tween(ie).to({x:320,y:660},550),currNPCHit=e.add.tween(ie).to({x:ie.x+10},30).to({x:ie.x-10,y:ie.y},60).to({x:ie.x+10,y:ie.y},60).to({x:ie.x,y:ie.y},30),de.onComplete.add(function(){ie.destroy()},this)},fe=function(){ie&&currNPCHit&&(y("currNPC.x: "+ie.x),currNPCHit.start(),y("currNPC.x: "+ie.x),y(ie))};j(e),e.tutorial={questionVisible:!1};var ce=!1;V.visible=!1,K.visible=!1,Q.visible=!1,H.visible=!1,e.eventManager.register(e.Events.DAY.START,function(t){e.displayManager.toggleCloudGeneration(!0),e.displayManager.togglePedestGeneration(!0),e.questionManager.populateQuestions(t.questions,C),e.uiItemGroup.callAll("kill"),m(e.playerState.getNumSlots(),e.playerState.getStockedItems()),M.text=h(t.clues.hero),O.text=h(t.clues.crisis),(e.interactionManager.getCurrentDay()||0)>0&&!S&&(F(),ce=!0)}),e.eventManager.register(e.Events.TIMER.PAUSE,s),e.eventManager.register(e.Events.TIMER.RESUME,s),e.eventManager.register(e.Events.INTERACT.OFFER,function(t,o,n,r){a(!0),e.dayTimer.pause(),e.dialog.main.isPrinting=!0,e.dialogManager.printMain(n,r,function(){e.dayTimer.resume(),e.dialog.main.isPrinting=!1})}),e.eventManager.register(e.Events.LEVEL.EXPUP,c),e.eventManager.register(e.Events.LEVEL.LEVELUP,function(){f(!0)}),e.eventManager.register(e.Events.INPUT.NO,fe),e.eventManager.register(e.Events.INVENTORY.SOLD,function(t,o){if(Y(o),e.playerState.getAvalItems().indexOf(t)>=0){var n=e.add.sprite(14,14,"item_"+t);n.scale.setTo(2,2),n.smoothed=!1;var a=e.add.tween(n.scale).to({x:8,y:8},550,Phaser.Easing.Linear.None,!0),r=e.add.tween(n).to({x:50,y:450,alpha:0},550,Phaser.Easing.Quadratic.Out,!0);r.onComplete.add(function(){n.destroy()}),r.start(),a.start()}}),e.eventManager.register(e.Events.UPDATE.ITEMS,function(t){for(var o in t)void 0!=g[o]&&g[o].setText(e.playerState.getItems()[o].toString())}),e.eventManager.register(e.Events.UPDATE.GOLD,function(e){U.setText(e)}),e.eventManager.register(e.Events.INTERACT.DIALOG,function(t){a(!1),e.dialog.main.isPrinting=!0,e.dialogManager.printMain(t,!1,function(){e.dialog.main.isPrinting=!1})}),e.eventManager.register(e.Events.TUTORIAL.BEGIN,function(){H.visible=!0,H.alpha=0,H.fadeIn=e.add.tween(H).to({alpha:.9},500,Phaser.Easing.Linear.None,!1,0,1e3,!0),H.dragIn=e.add.tween(H).to({y:535},500,Phaser.Easing.Linear.None,!1),H.shake=e.add.tween(H.position).to({x:"10"},100,Phaser.Easing.Quadratic.None,!1,0,1e3,!0),H.fadeIn.start(),H.shake.start(),H.dragIn.start(),e.tutorial.questionVisible=!0,Q.fadeIn.start(),Q.dragIn.start()}),e.eventManager.register(e.Events.TUTORIAL.FAILED,function(){e.playerState.getGold()<=1?(e.analytics.set("dimension3","inexperiened"),e.conditionManager.set("jeffReminder"),e.analytics.track("interaction","jeffReminder")):e.analytics.set("dimension3","experiened")}),e.eventManager.register(e.Events.DOG.APPEAR,function(){e.displayManager.dog.visible=!0}),e.reset.register(function(){e.displayManager.dog.visible=!1}),e.eventManager.register(e.Events.INTERACT.NEW,function(t,o,n){function a(e){e=e.substring(e.indexOf("skin")+6,e.length-1);var t=e.split(",");return{r:parseFloat(t[0]),g:parseFloat(t[1]),b:parseFloat(t[2])}}e.dialog.main.freeze(!0),e.questionManager.hideQuestions(),r(!1),y("GENERATING NPC IMG: "+t);var i=!1,s=null;switch(t){case"jeff":t="gp_jeff_big";break;case"dog":t="gp_dog_set",s=function(e){};break;case"artifact":t="hero_artifact";break;case"cloak":t="hero_cloak";break;case"guardian":t="hero_guardian";break;case"king_zoran":t="hero_king_zoran";break;case"treasure_hunter":t="hero_treasure_hunter";break;default:i=!0}var d=function(){var s,d=a(t);if(s=i?e.displayManager.drawRandomNPC(t.substring(0,t.indexOf("skin")-1),d):t,ie=P.create(20,360,s),o&&o.substring()&&10==o.length){var l=e.displayManager.generateNPCHands(o.substring(0,5),o.substring(5,10),d);le=P.create(50,600,l),le.tweenIn=e.add.tween(le).to({y:390},500),le.tweenOut=e.add.tween(le).to({y:600},300),le.tweenIn.onComplete.addOnce(function(){e.time.events.add(Phaser.Timer.SECOND*(n?n:1.5),function(){le.tweenOut.start()},this)}),le.tweenOut.onComplete.addOnce(function(){le.destroy()})}if(ue(),i)ie.scale.setTo(3,3);else{switch(s){case"gp_jeff_big":ie.scale.setTo(2,2);break;case"gp_dog_set":ie.scale.setTo(1.5,1.5)}ie.smoothed=!1}se.onComplete.add(function(){o&&le.tweenIn.start(),r(!0),e.dialog.main.freeze(!1)}),se.start()};ie?(le&&le.tweenOut.start(),de.start(),de.onComplete.addOnce(d),S&&!ce?F():ce=!1):d(i)}),e.eventManager.register(e.Events.DAY.END,function(){e.displayManager.toggleCloudGeneration(!1),e.displayManager.togglePedestGeneration(!1),S&&F()}),W(e)},update:function(){n(e.dayTimer.getPercent()),t.updateCrop(),o.updateCrop(),e.displayManager.updateSunPosition(e.dayTimer.getPercent()),e.displayManager.updateSky(e.dayTimer.getPercent())}}}function n(e){var t,o,n,a,r,i=null,s=null;this.gameWon=!1,this.setGameResult=function(e){gameWon=e};this.endState=function(){function d(){t.kill(),o.kill(),n.kill(),a.kill(),r.kill(),null!=i&&i.kill(),i=null,null!=s&&s.kill(),s=null}function l(){e.analytics.track("game","restartLevel"),d(),e.conditionManager.revertToCheckpoint(),e.playerState.resetStats(),e.stock.resetStock(e.playerState.getItems()),e.restartDay()}function u(){e.analytics.track("game","restartGame"),d(),e.reset.start(),e.state.start("state_start")}if(e.stage.backgroundColor="#000000",t=e.add.graphics(0,0),t.beginFill(0,1),t.drawRect(0,0,800,600),o=e.add.text(700,500,"Restart Game",{font:"20px yoster_islandregular",fill:"#FFFFFF",align:"right"}),n=e.add.text(240,500,"Restart Day",{font:"20px yoster_islandregular",fill:"#FFFFFF",align:"left"}),o.anchor.setTo(1,1),o.inputEnabled=!0,n.anchor.setTo(1,1),n.inputEnabled=!0,n.events.onInputOver.add(function(){n.fill="#d3af7a"},this),o.events.onInputOver.add(function(){o.fill="#d3af7a"},this),n.events.onInputOut.add(function(){n.fill="#FFFFFF"},this),o.events.onInputOut.add(function(){o.fill="#FFFFFF"},this),o.events.onInputDown.add(u),n.events.onInputDown.add(l),a=e.add.image(0,0,"endday_boxoutline"),r=e.add.image(0,0,"endday_boxoutline"),a.x=o.x-o.width-10,r.x=n.x-n.width-10,a.y=o.y-o.height-15,r.y=n.y-n.height-15,gameWon){n.kill(),r.kill();var f=52,c=1*e.playerState.getGold(),h=e.playerState.getStockedItems();for(var p in h){var g=h[p],y=0;switch(p){case"sword":y=4.5;break;case"chicken":y=2.8;break;case"bow":y=6.4;break;case"shield":y=1.5}c+=g*y}e.analytics.track("game","won",c),c=4*Math.min(1,c/f);var m="";m=1.8>=c?"I mean...Come on...":2.5>=c?"Awwwww...This is pretty sad...":3>=c?"I hope you have S/NS'ed...":3.5>=c?"Still, probably won't make the Dean's List.":3.9>=c?"That'll look nice on the Grade Report.":"Wow... [The ancient sales manager is surprised.]\n[Sadly...\n he doesn't have any surprise for you...]",s=e.add.text(100,200,"THANK YOU!\nYou have reached the end of the demo.\nThe ancient sales manager gave you\n a rating of "+parseFloat(Math.round(10*c)/10).toFixed(1)+"/4.0\n\n"+m,{font:"28px yoster_islandregular",fill:"#e7bd68"})}else i=e.add.text(100,200,"GAME OVER: You have gone broke",{font:"32px yoster_islandregular",fill:"#FFFFFF"})}}function a(e){function t(){a=e.add.group(),i=e.add.sprite(0,0),r=e.add.image(0,0,"gp_moon");var t=e.add.graphics(0,0);t.beginFill(0,1),t.drawRect(0,0,800,600),i.width=800,i.height=600,i.events.onInputDown.add(o,this),i.addChild(t),i.inputEnabled=!0,a.fadeIn=e.add.tween(a).to({alpha:1},500),a.fadeOut=e.add.tween(a).to({alpha:0},500),a.add(i),a.add(r),a.add(e.dialog.wrapup.box),a.visible=!1,i.events.onInputDown.add(n,this)}function o(){s&&e.analytics.track("text","wrapupNoSkip"),i.events.onInputDown.removeAll(),s=!0,i.events.onInputDown.add(n,this),e.eventManager.notify(e.Events.WRAPUP.NEXT)}function n(){s&&e.analytics.track("text","wrapupSkipAttempt"),s=!1}var a,r,i,s=!1;e.eventManager.register(e.Events.WRAPUP.START,function(){i.events.onInputDown.removeAll(),i.events.onInputDown.add(n,this),e.dialogManager.printWrapup(""),a.alpha=0,a.visible=!0,a.fadeIn.onComplete.addOnce(o),a.fadeIn.start()}),e.eventManager.register(e.Events.WRAPUP.END,function(){e.dialogManager.printWrapup(""),a.visible=!1,a.fadeOut.start()}),e.eventManager.register(e.Events.WRAPUP.MESSAGE,function(t){e.dialogManager.printWrapup(t,function(){i.events.onInputDown.removeAll(),i.events.onInputDown.add(o,this)})}),t()}function r(e){function t(e,t){e.position.copyFrom(t),e.position.y+=t.height-e.height/2,e.position.x+=t.width/2-e.width/2}function o(){this.cloud.inputEnabled=!1;var t=h(5,8);y("UI: star cloud clicked! Rewarding "+t+" gold."),e.analytics.track("cloud","clicked");for(var o=e.add.group(),n=0;t>n;n++)o.create(this.cloud.x+h(-20,20),this.cloud.y+h(-20,20),"ui_coin");var a=e.add.tween(o.position).to({x:10-this.cloud.x,y:570-this.cloud.y},800,Phaser.Easing.Quadratic.Out),r=e.add.tween(o).to({alpha:0},500);r.onComplete.add(function(){o.destroy()}),a.start(),r.start(),e.playerState.addsubGold(t);var i=this.cloud,s=e.add.tween(this.cloud).to({y:"+10"},100).to({y:600},700,Phaser.Easing.Bounce.Out);s.onComplete.add(function(){i.destroy()}),s.start(),e.eventManager.notify(e.Events.UPDATE.GOLD,e.playerState.getGold())}function n(t){t.dialogIn=e.add.tween(t).to({alpha:1},500,Phaser.Easing.Bounce.In),t.dialogPop=e.add.tween(t.scale).from({x:0,y:0},700,Phaser.Easing.Bounce.Out),t.dialogOut=e.add.tween(t.scale).to({x:0,y:0},300,Phaser.Easing.Quadratic.Out),t.dialogOut.onComplete.add(function(){t.destroy()})}function a(t,o,a,r){var i=e.add.group();e.depthGroups.dialogGroup.add(i),n(i);var s=12,d=(i.create(t,o,"ui_jeff_dialog_corner"),i.create(t+a+s,o,"ui_jeff_dialog_corner")),l=(i.create(t,o+r-8,"ui_jeff_dialog_tip"),i.create(t+a+s,o+r,"ui_jeff_dialog_corner"));d.angle+=90,l.angle+=180;for(var u=t+s;t+a>=u;u+=2){var f=(i.create(u,o,"ui_jeff_dialog_border"),i.create(u,o+r,"ui_jeff_dialog_border"));f.angle+=180}for(var c=o+s;o+r>=c;c+=2){var h=i.create(t,c,"ui_jeff_dialog_border");if(h.angle+=270,o+r-s>c){var p=i.create(t+a+s,c,"ui_jeff_dialog_border");p.angle+=90}}var g=e.add.graphics(0,0);g.beginFill(16777162),g.drawRect(0,0,a,r-s);var m=i.create(t+s/2,o+s/2);m.addChild(g),i.x=t+a/2,i.y=o+r/2,i.pivot.x=t+a/2,i.pivot.y=o+r/2,i.alpha=0,y("UI: put Jeff dialog at "+t+", "+o+" with width: "+a+" height: "+r)}var r=16777215,i=(h(5,13),h(200,300),h(1800,3200),e.time.create(!1),!0);h(4,10),h(350,400),h(1200,2e3),e.time.create(!1);this.prepareStage=function(){e.renderer.renderSession.roundPixels=!0,e.stage.smoothed=!1,e.stage.backgroundColor="#92cb9a"},this.tintClouds=function(e){this.clouds.setAll("tint",e),r=e},this.putEnvironment=function(){this.imgBackgroundSky=e.add.group(),this.imgBackgroundSky.dawn=e.add.image(0,0,"gp_background_sky_dawn"),this.imgBackgroundSky.noon=e.add.image(0,0,"gp_background_sky"),this.imgBackgroundSky.afternoon=e.add.image(0,0,"gp_background_sky_noon"),this.imgBackgroundSky.dusk=e.add.image(0,0,"gp_background_sky_dusk"),this.imgSun=e.add.sprite(400,100,"gp_sun"),this.clouds=e.add.group(),this.pedests=e.add.group(),this.cloudTimer=e.time.create(!1),this.pedestTimer=e.time.create(!1),this.imgBackgroundTown=e.add.image(0,0,"gp_background_town"),this.shopKeeper=e.add.sprite(500,272,"gp_shopkeeper"),this.dog=e.add.sprite(440,300,"gp_dog_small"),this.dog.visible=!1,this.shop=e.add.sprite(0,0,"shop_rock"),this.jeff=e.add.sprite(this.shopKeeper.x+35,277,"gp_jeff_noshadow"),this.jeffShadow=e.add.sprite(this.shopKeeper.x+43,this.shopKeeper.y+this.shopKeeper.height-7,"gp_jeff_shadow"),this.imgBackgroundSky.add(this.imgBackgroundSky.dawn),this.imgBackgroundSky.add(this.imgBackgroundSky.noon),this.imgBackgroundSky.add(this.imgBackgroundSky.afternoon),this.imgBackgroundSky.add(this.imgBackgroundSky.dusk),e.depthGroups.envGroup.add(this.imgBackgroundSky),e.depthGroups.envGroup.add(this.imgSun),e.depthGroups.envGroup.add(this.clouds),e.depthGroups.envGroup.add(this.imgBackgroundTown),e.depthGroups.envGroup.add(this.shopKeeper),e.depthGroups.envGroup.add(this.dog),e.depthGroups.envGroup.add(this.jeff),e.depthGroups.envGroup.add(this.jeffShadow),e.depthGroups.pedestGroup.add(this.pedests),this.imgSun.anchor.setTo(.5,.5),this.shop.smoothed=!1,this.shop.alpha=0,this.shop.visible=!1,this.shop.shopFadeTween=e.add.tween(this.shop).to({alpha:1},2e3,Phaser.Easing.Linear.None,!1),t(this.shop,this.shopKeeper),this.dog.anim=this.dog.animations.add("doge"),this.dog.animations.play("doge",3,!0),this.jeff.floating=e.add.tween(this.jeff).to({y:260},2e3,Phaser.Easing.Quadratic.None,!0,0,1e3,!0),this.jeffShadow.alpha=.6,this.jeffShadow.fadeIn=e.add.tween(this.jeffShadow).to({alpha:.2},2e3,Phaser.Easing.Quadratic.None,!0,0,1e3,!0)},this.putLoadingBackground=function(){var t=e.add.image(0,500,"gp_background");t.arriveTween=e.add.tween(t).to({y:"-300"},300,Phaser.Easing.Quadratic.None,!0)},this.putTitleScreen=function(){var t=e.add.sprite(0,0,"gp_title"),o=e.add.sprite(400,400,"gp_clickstart"),n=e.add.sprite(400,590,"gp_dev");t.alpha=0,o.alpha=0,o.anchor.setTo(.5,.5),o.blinkTween=e.add.tween(o).to({alpha:1},1e3,Phaser.Easing.Linear.None,!0,0,500,!0),t.shakeTween=e.add.tween(t).to({y:"-10"},1e3,Phaser.Easing.Quadratic.In,!0,0,500,!0),t.fadeIn=e.add.tween(t).to({alpha:1},300,Phaser.Easing.Quadratic.None,!0),n.anchor.setTo(.5,1)},this.updateSunPosition=function(e){this.imgSun.position.x=Y.RESOLUTION[0]*e,this.imgSun.position.y=Y.RESOLUTION[1]/3-Math.sin((1-e)*Math.PI)*(Y.RESOLUTION[1]/6)},this.updateSky=function(e){var t=1-e;this.imgBackgroundSky.dawn.alpha=t>=Q.dawn.start&&t<=Q.dawn.end?1-t/Q.dawn.end:0,this.imgBackgroundSky.noon.alpha=t>=Q.noon.start&&t<=Q.noon.end?Math.sin((t-Q.noon.start)/(Q.noon.end-Q.noon.start)*Math.PI):0,this.imgBackgroundSky.afternoon.alpha=t>=Q.afternoon.start&&t<=Q.afternoon.end?Math.sin((t-Q.afternoon.start)/(Q.afternoon.end-Q.afternoon.start)*Math.PI):0,this.imgBackgroundSky.dusk.alpha=t>=Q.dusk.start?Math.sin((t-Q.dusk.start)/(Q.dusk.end-Q.dusk.start)*Math.PI/2):0,this.imgBackgroundSky.dusk.alpha=t>=Q.dusk.end?1:this.imgBackgroundSky.dusk.alpha},this.putCloud=function(){this.randomCloudAttr(),y("UI: Putting cloud at "+this.cloudY);var t="gp_cloud";2==h(1,14)&&i&&(t="gp_cloud_star",this.cloudDur=4800);var n=this.clouds.create(-58,this.cloudY,t);n.tint=r,n.floatTween=e.add.tween(n).to({x:Y.RESOLUTION[0]},this.cloudDur),n.floatTween.start(),n.floatTween.onComplete.add(function(){n.destroy()}),"gp_cloud_star"==t&&(n.inputEnabled=!0,n.events.onInputDown.add(o,{cloud:n})),this.cloudGenerationOn&&this.cloudTimer.add(Phaser.Timer.SECOND*e.rnd.realInRange(3,8),this.putCloud,this)},this.toggleCloudGeneration=function(e){this.cloudGenOn=e,e?(this.putCloud(),this.cloudTimer.start()):this.cloudTimer.running&&this.cloudTimer.stop()},this.cloudGenerationOn=function(){return this.cloudGenOn},this.randomCloudAttr=function(){this.cloudIntv=h(1,15),this.cloudY=h(100,240),this.cloudDur=h(4e4,8e4)},this.putPedestrian=function(){this.randomPedestAttr();var t="gp_passerby",o=this.pedests.create(-15,this.pedestY,t),n=this.pedestDur/90;o.anchor.setTo(.5,1),o.tint=10066329-16384*Math.random(),o.stepCount=0,y("UI: Putting pedestrian at "+this.pedestY+" with tint: "+o.tint.toString(16)),1==h(1,3)?o.moveTween=e.add.tween(o).to({x:Y.RESOLUTION[0]+15},this.pedestDur,Phaser.Easing.Linear.None,!0,0,-1):(o.x=Y.RESOLUTION[0]+15,o.scale.x*=-1,o.moveTween=e.add.tween(o).to({x:-15},this.pedestDur,Phaser.Easing.Linear.None,!0,0,-1)),o.walkTween=e.add.tween(o).to({y:"-4"},n,Phaser.Easing.Quadratic.InOut,!0,0,500,!0),o.moveTween.onComplete.add(function(){o.destroy()}),o.walkTween.start(),o.moveTween.start(),this.pedestGenerationOn&&this.pedestTimer.add(Phaser.Timer.SECOND*this.pedestIntv,this.putPedestrian,this),this.pedests.sort("y",Phaser.Group.SORT_ASCENDING)},this.togglePedestGeneration=function(e){this.pedestGenOn=e,e?(this.putPedestrian(),this.pedestTimer.start()):this.pedestTimer.running&&this.pedestTimer.stop()},this.pedestGenerationOn=function(){return this.pedestGenOn},this.randomPedestAttr=function(){this.pedestIntv=h(2,40),this.pedestY=h(350,420),this.pedestDur=h(24e3,48e3)},this.putJeffDialog=function(t,o,n,r,i){i=i||function(){},a(t,o,n,r);for(var s=0;s<e.depthGroups.dialogGroup.children.length;s++){var d=e.depthGroups.dialogGroup.children[s];d.dialogIn.onComplete.add(i),d.dialogIn.start(),d.dialogPop.start()}},this.clearJeffDialog=function(){for(var t=0;t<e.depthGroups.dialogGroup.children.length;t++){var o=e.depthGroups.dialogGroup.children[t];o.dialogOut.start()}},this.drawRandomNPC=function(t,o){for(var n=e.add.bitmapData(60,70),a=t.split(","),r=0;r<a.length;r++){var i=a[r].split("|"),s=i[0],d=parseInt(i[1]);n.draw("npc-"+s+"-"+d)}return E(n,190,147,125,255,o.r,o.g,o.b,255,60,70),E(n,173,122,95,255,.85*o.r,.75*o.g,.65*o.b,255,60,70),n},this.generateNPCHands=function(t,o,n){var a=e.make.sprite(0,0,"npc-hand"),r=e.add.bitmapData(168,198);a.anchor.setTo(.5,0),a.scale.x=-1,r.draw(a,35,100),r.draw("npc-hand",70,100);for(var i=0;5>i;i++){var s="1"==t.charAt(i)?"":"-c",d="1"==o.charAt(i)?"":"-c",l=e.make.sprite(0,0,"npc-hand-"+i+s);l.anchor.setTo(.5,0),l.scale.x=-1,r.draw(l,35,100),r.draw("npc-hand-"+i+d,70,100),l.destroy()}return E(r,190,147,125,255,n.r,n.g,n.b,255,168,198),E(npcBmd,173,122,95,255,.85*n.r,.75*n.g,.65*n.b,255,60,70),a.destroy(),r}}function i(e){this.game=e,this.assetFolder="assets/",this.spriteSheets={button_item_border:[22,22],button_add:[11,11],button_sub:[11,11],gp_dog_small:[48,36],upgrade_:[100,100],button_continue:[128,128],button_start:[160,53],button_accept:[63,22],button_reject:[63,22],button_question:[63,22],gp_sun:[96,96]},this.assets={gameplay:["gp_title","gp_clickstart","gp_dev","gp_background","gp_background_town","gp_background_sky","gp_background_sky_dawn","gp_background_sky_noon","gp_background_sky_dusk","gp_sun","gp_moon","gp_cloud","gp_cloud_star","gp_shopkeeper","gp_passerby","gp_stock","gp_jeff","gp_jeff_noshadow","gp_jeff_shadow","gp_jeff_big","gp_dog_small","gp_dog_big","gp_dog_tail","gp_dog_tounge","gp_dog_claw_1","gp_dog_claw_2","gp_dog_set"],ui:["endday_boxoutline","ui_itemslot","ui_jeff_dialog_corner","ui_jeff_dialog_tip","ui_jeff_dialog_border","ui_dialog","ui_note","ui_note_big","ui_table","ui_levelup","ui_table_background","ui_clock","ui_funnel","ui_funnel_sand_top","ui_funnel_sand_buttom","ui_button_accept","ui_button_reject","ui_button_question","ui_button_continue","ui_button_add","ui_button_sub","ui_button_item_border","shop_rock","shop_wooden","shop_wooden_plus","shop_wooden_desk","shop_stone","upgrade_jeff","upgrade_shop","upgrade_itemslot","upgrade_time","ui_coin","ui_coins","ui_coinstack","ui_button_start","right_textbox","left_textbox","middle_textbox"],hero:["hero_artifact","hero_cloak","hero_guardian","hero_king_zoran","hero_treasure_hunter"],items:["item_sword","item_bow","item_chicken","item_shield"],npc:{face:5,misc:7,body:8,hair:11,eye:10,nose:11,mouth:11,hand:"npc_hand"}},this.load=function(){for(var t in this.assets)if(this.assets.hasOwnProperty(t))if("npc"==t)for(var o in this.assets[t]){var n=this.assets[t][o];if(n.substring){var a="assets/npc/"+o+"/"+n+".png";e.load.image("npc-"+o,a);for(var r=0;5>r;r++){var i="assets/npc/"+o+"/"+n+"_"+r,s="npc-"+o+"-"+r;e.load.image(s,i+".png"),e.load.image(s+"-c",i+"_c.png"),y("LOADING NPC HANDS ["+o+"] #"+r+"	"+i+"	id: "+s)}}else for(var r=1;n>=r;r++){var d="assets/npc/"+o+"/"+r+".png";e.load.image("npc-"+o+"-"+r,d),y("LOADING NPC PART ["+o+"] #"+r+"	"+d)}}else for(var l=0;l<this.assets[t].length;l++){var u=this.assets[t][l],f=this.assetFolder+t+"/"+u+".png",c=!1;for(var h in this.spriteSheets)if(u.indexOf(h)>=0){y("LOADING(spritesheet): "+f),this.game.load.spritesheet(u,f,this.spriteSheets[h][0],this.spriteSheets[h][1]),c=!0;break}c||(y("LOADING(image): "+f),this.game.load.image(u,f)),y("LOADED: "+u)}}}function s(e){function t(){e.physics.startSystem(Phaser.Physics.ARCADE),A=e.add.group(),C=e.add.image(0,0,"gp_stock"),M=e.add.button(620,538,"ui_button_start",i,this,1,0,2),S=e.add.text(627,542-M.height/2,"Stock Items",{font:"20px yoster_islandregular",fill:"#CC0000"}),S.alpha=0,A.add(C),A.add(M),A.add(S),e.eventManager.register(e.Events.UPDATE.ITEMS,m),e.eventManager.register(e.Events.UPDATE.STOCKGOLD,function(e){void 0!==O&&null!=O&&O.setText(e)}),e.eventManager.register(e.Events.STOCK.INIT,n),A.visible=!1}function o(t){x=e.add.text(200,435,a(t),{font:"20px yoster_islandregular",fill:"#3B3B3B",wordWrap:!0,wordWrapWidth:400})}function n(t,o,n,a){E=c(n,a),_=f(t),h(E),y(_),O=e.add.text(64,520,"0",{font:"30px yoster_islandregular",fill:"#c67520"}),O.setText(o),O.anchor.setTo(.5,0)}function a(e){for(var t="",o=0;o<e.length;o++)""!==e[o]&&(t+="> "+e[o]+"\n");return t}function r(){for(var e in E)E[e].tinted.kill(),E[e].itemborder.kill(),E[e].kill();for(var t=0;t<_.length;t++)_[t].minus.kill(),_[t].plus.kill(),_[t].num.kill(),_[t].kill();O.kill(),x.kill()}function i(){if(!d())return void s();A.visible=!1;for(var t in E)E[t].priceText.visible=!1;r(),e.eventManager.notify(e.Events.STOCK.COMMIT,l()),P()}function s(){var t=e.add.tween(S).to({alpha:1},1e3);t.onComplete.add(function(){var t=e.add.tween(S).to({alpha:0},1e3);t.start()}),t.start()}function d(){for(var e=0;e<_.length;e++)if(null!=_[e].loaded)return!0}function l(){for(var e=[],t=0;t<_.length;t++)null!=_[t].loaded&&e.push(_[t].loaded.itemname);return e}function u(t){for(var o=e.add.group(),n=0;t>n;n++)o.create(20+50*Math.random(),450+30*Math.random(),"ui_coin");var a=e.add.tween(o.position).to({y:o.y+100},800,Phaser.Easing.Quadratic.Out),r=e.add.tween(o.alpha).to({alpha:.5},500);r.onComplete.add(function(){o.destroy()}),a.start(),r.start()}function f(t){for(var o=[],n=0;t>n;n++){var a=e.add.sprite(20,40+70*n,"ui_itemslot");a.anchor.setTo(0,0),o.push(a)}return o}function c(t,o){for(var n={},a=0;a<t.length;a++){var r=e.add.sprite(0,0,"item_"+t[a]);r.itemType=t[a],r.num=void 0===o[t[a]]?0:o[t[a]]+0,r.orignum=void 0===o[t[a]]?0:o[t[a]]+0,r.smoothed=!1,n[t[a]]=r}return n}function h(t){var o=Math.floor((e.width-D-R[0])/(G+N)),n=-1;for(var a in t)n++,e.physics.arcade.enable(t[a]),t[a].itemname=a,t[a].loaded=!1,t[a].inputEnabled=!0,t[a].scale.setTo(2,2),t[a].input.enableDrag(),t[a].events.onDragStop.add(T,this),t[a].events.onDragStart.add(b,this),t[a].position.x=R[0]+n%o*(G+N),t[a].position.y=R[1]+Math.floor(n/o)*(G+N),t[a].itemborder=e.add.image(t[a].position.x-6,t[a].position.y-6,"ui_button_item_border"),t[a].itemborder.scale.setTo(2,2),e.world.bringToTop(t[a].itemborder),t[a].originalPosition=t[a].position.clone(),t[a].price=X[a].price,t[a].priceText=e.add.text(t[a].position.x,t[a].position.y+t[a].height+5,"Price: "+t[a].price,{font:"18px yoster_islandregular",fill:"#d3af7a"}),t[a].priceText.visible=!1,t[a].tinted=e.add.image(t[a].position.x,t[a].position.y,t[a].key),t[a].tinted.scale.setTo(2,2),t[a].tinted.tint="#7F7F7F",e.world.bringToTop(t[a]),t[a].events.onInputOver.add(p,t[a]),t[a].events.onInputOut.add(g,t[a]),t[a].loader=null}function p(e,t){e.priceText.visible=!0,e.priceText.x=e.position.x,e.loaded||(e.priceText.x-=20),e.priceText.y=e.position.y+e.height+5}function g(e,t){e.loaded||(e.priceText.visible=!1)}function y(t){for(var o=0;o<t.length;o++)t[o].anchor.setTo(0,0),t[o].name=t[o].key+": "+o,t[o].plus=e.add.button(t[o].position.x+t[o].width+10,t[o].position.y-2,"ui_button_add",w,this,1,0,2),t[o].plus.scale.setTo(2,2),t[o].minus=e.add.button(t[o].position.x+t[o].width+10,t[o].position.y+t[o].height/2,"ui_button_sub",v,this,1,0,2),t[o].minus.scale.setTo(2,2),t[o].plus.loader=t[o],t[o].minus.loader=t[o],t[o].num=e.add.text(t[o].position.x+t[o].width/2,t[o].position.y+8,"X",{font:"20px yoster_islandregular",fill:"#d3af7a"}),t[o].loaded=null,e.physics.arcade.enable(t[o])}function m(e){for(var t in e)void 0!==E&&null!=E&&(E[t].num=e[t]+0)}function v(t,o){if(null!=t.loader&&null!=t.loader.loaded){var n=t.loader.loaded.num;e.eventManager.notify(e.Events.STOCK.REMOVE,t.loader.loaded.itemType,1),t.loader.num.text=t.loader.loaded.num,n!=t.loader.loaded.num&&u(1)}}function w(t,o){null!=t.loader&&null!=t.loader.loaded&&(e.eventManager.notify(e.Events.STOCK.ADD,t.loader.loaded.itemType,1),
t.loader.num.text=t.loader.loaded.num)}function b(t,o){e.world.bringToTop(t),g(t,o);for(var n=0;n<_.length;n++)Phaser.Rectangle.intersects(t.getBounds(),_[n].getBounds())&&(_[n].num.text="X",_[n].loaded=null)}function T(t,o){var n=!1;Phaser.Rectangle.intersects(t.getBounds(),t.itemborder.getBounds())?(loader=I(),n=!0):loader=k(t,_),void 0!=loader&&void 0!==loader.loaded&&null==loader.loaded&&null==t.loader||void 0===loader&&null!=t.loader&&0==n?(void 0===loader&&(loader=t.loader),t.position.copyFrom(loader.position),t.position.x+=4,t.position.y+=4,t.loaded=!0,t.loader=loader,p(t,null),loader.num.text=t.num+"",loader.loaded=t):(t.position.copyFrom(t.originalPosition),t.loaded=!1,t.loader=null,e.world.bringToTop(t.itemborder),u(t.num-t.orignum),e.eventManager.notify(e.Events.STOCK.OUTSTOCK,t.itemType),u(),g(t,o))}function I(){for(var e=0;e<_.length;e++)if(null==_[e].loaded)return _[e];return null}function k(e,t){for(var o=0;o<t.length;o++)if(Phaser.Rectangle.intersects(e.getBounds(),t[o].getBounds()))return t[o]}var _,E,x,O,M,S,C,A,P,G=30,N=50,D=50,R=[275,100];this.startDay=function(t,n){A.visible=!0,e.world.bringToTop(A),o(t),P=n,e.eventManager.notify(e.Events.STOCK.STARTDAY)},t()}function d(){var e=[];this.register=function(t){e.push(t)},this.start=function(){for(var t=0;t<e.length;t++)e[t]()}}function l(e){function t(e){for(var t in a)if(a[t]===e)return t;return!1}function o(e,t){if(e instanceof Array)a[t]=e;else for(var n in e)o(e[n],t+"."+n)}var n=this;e.Events={DAY:{START:[],END:[]},INPUT:{YES:[],NO:[],CONTINUE:[],QUESTION:[],ITEM:[],PROFILE:[]},INTERACT:{NEW:[],DIALOG:[],OFFER:[]},INVENTORY:{SOLD:[],NOTSOLD:[]},UPDATE:{GOLD:[],ITEMS:[],STOCKGOLD:[],SHOP:[]},STOCK:{ADD:[],REMOVE:[],COMMIT:[],OUTSTOCK:[],INIT:[],STARTDAY:[]},LEVEL:{LEVELUP:[],EXPUP:[],ACCEPT:[]},TUTORIAL:{BEGIN:[],FAILED:[]},WRAPUP:{START:[],NEXT:[],END:[],MESSAGE:[]},TIMER:{JUMP:[],RESUME:[],PAUSE:[]},DOG:{APPEAR:[]}},this.register=function(e,o){return e instanceof Array&&"function"==typeof o?(y("REGISTERING CB FOR: "+t(e)),e.push(o),!0):(Y.DEBUG_MODE&&alert("REGISTERING INVALID CALLBACK"),!1)},this.remove=function(e,o){if(!(e instanceof Array)||"function"!=typeof o)return Y.DEBUG_MODE&&alert("REMOVING INVALID CALLBACK"),!1;y("REMOVING CB FOR: "+t(e));var n=e.indexOf(o);n>-1&&e.splice(n,1)},this.notify=function(e){if(!(e instanceof Array))return Y.DEBUG_MODE&&alert("NOTIFYING INVALID CALLBACK"),!1;for(var o=[],n=1;n<arguments.length;n++)o.push(arguments[n]);var a=e.slice();y("NOTIFYING CB(s) FOR: "+t(e)+", with args: "+JSON.stringify(o));for(var r=0;r<a.length;r++)a[r].apply(window,o)},this.notifyByName=function(e){for(var t=[a[e]],o=1;o<arguments.length;o++)t.push(arguments[o]);return n.notify.apply(this,t)};var a={};o(e.Events,"Events")}function u(){function e(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=0;8>o;o++)e+=t.charAt(Math.floor(Math.random()*t.length));return e}var t=this,o="TESTING";this.track=function(e,t,n){y("Tracking: "+e+", "+t+", "+n),ga("send",{hitType:"event",eventCategory:e,eventAction:t,eventLabel:o,eventValue:n})},this.set=function(e,t){y("Tracking dimension: "+e+", "+t),ga("set",e,t),ga("send","pageview")},this.setRunID=function(){t.set("dimension6",e())},this.set("dimension2",e()),this.set("dimension7",e())}function f(e){return Math.random()<=e}function c(e){return JSON.parse(JSON.stringify(e))}function h(e,t){var o=t-e;return Math.floor(e+Math.random()*o)}function p(e,t){var o=g(0,.6),n=(t+e)/2;return n+=Math.max(Math.min(1,o()),-1)*((t-e)/2),Math.ceil(n)}function g(e,t){var o,n=!1;return function(){var a;if(n)a=o,n=!1;else{var r,i,s;do r=2*Math.random()-1,i=2*Math.random()-1,s=r*r+i*i;while(s>=1);s=Math.sqrt(-2*Math.log(s)/s),a=r*s,o=i*s,n=!0}var d=e+t*a;return d}}function y(e){Y.DEBUG_MODE&&console.log(e)}function m(e){var t=["zero","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen"],o=["zero","ten","twenty","thirty","fourty","fifty","sixty","seventy","eighty","ninety"];if("number"==typeof e){if(e<t.length)return t[e];if(100>e){var n=o[Math.floor(e/10)],a=t[e%10];return n+" "+a}}return e}function v(e){var t=["a","e","i","o","u"];return-1!==t.indexOf(e.charAt(0).toLowerCase())?"an "+e:"a "+e}function w(e){for(var t=e.length-1;t>0;t--){var o=Math.floor(Math.random()*(t+1)),n=e[t];e[t]=e[o],e[o]=n}return e}function b(e,t){var o=Math.floor(Math.random()*e.length),n=e[o];return t&&e.splice(o,1),n}function T(e){var t=["zeroeth","first","second","third","fourth"];return t[e]}function I(e,t){return{category:e,hero:t,fuzz:0,force:!0}}function k(e){var t=["th","st","nd","rd"],o=e%100;return e+(t[(o-20)%10]||t[o]||t[0])}function _(){var e={r:255,g:255,b:255},t=-3+6*Math.random();return Math.random()<.5?(e.r=224.3+9.6*t,e.g=193.1+17*t,e.b=177.6+21*t):(e.r=168.8+38.5*t,e.g=122.5+32.1*t,e.b=96.7+26.3*t),e}function E(e,t,o,n,a,r,i,s,d,l,u){for(var f=e.ctx.getImageData(0,0,l,u),c=f.data.length,h=0;c/4>h;h++)f.data[4*h]===t&&f.data[4*h+1]===o&&f.data[4*h+2]===n&&(f.data[4*h]=r,f.data[4*h+1]=i,f.data[4*h+2]=s,f.data[4*h+3]=d);e.ctx.putImageData(f,0,0)}function x(e,t,o,n){var a,r,i=this,s=t,d=!0;this.pause=function(e){d||(clearTimeout(a),s-=Date.now()-r,o&&!e&&o(),y("PAUSING TIMER: "+s)),d=!0},this.resume=function(t){d&&(r=Date.now(),clearTimeout(a),a=setTimeout(e,s),n&&!t&&n(),y("RESUMING TIMER: "+s)),d=!1};var l=0,u=0;this.jumpForward=function(e){i.pause(!0),l+u-Date.now()>0?(u=Date.now()-l,l+=e):(u=Date.now(),l=e),s-=e,i.resume(!0)},this.getPercent=function(){var e=(s+Math.max(l+u-Date.now(),0))/t;if(d)return e;var o=(s+r-Date.now()+Math.max(l+u-Date.now(),0))/t;return o},this.resume()}function O(e){function t(t){var r=a[t];if(o(r)){if(f(r.chance)){if(y("SETTING COMPOUND CONDITION: "+t),n.push(t),r.events)for(var s=0;s<r.events.length;s++)e.eventManager.notifyByName(r.events[s]);r.isLongTerm&&(y("SETTING LONGTERM CONDITION: "+t),i.push(t))}else y("DROPPING COMPOUND CONDITION: "+t);delete a[t]}}function o(e){for(var t=e.components,o=0;o<t.length;o++){var a=n.indexOf(t[o])>-1;if(!a)return!1}return!0}var n,a,r,i=[];this.init=function(e){a=e,n=i.slice(),r=i.slice()},this.revertToCheckpoint=function(){i=r},this.set=function(e){if(-1===n.indexOf(e)){n.push(e),y("SETTING CONDITION: "+e);for(var o in a)t(o)}},this.get=function(t){if(t instanceof Array){for(var o=0;o<t.length;o++){var a=n.indexOf(t[o])>-1;if(!a)return!1}return!0}if(t.indexOf("gold_")>-1){var r=parseInt(t.substring(5));return r<=e.playerState.getGold()}var a=n.indexOf(t)>-1;return a}}function M(e){function t(){for(var e=0;e<d.length;e++)d[e].visible=!1,d[e].textbox.visible=!1,d[e].kill();d=[]}function o(t){var o=Math.ceil((20+t.width)/19),n=e.add.group();e.depthGroups.questionGroup.add(n);var a=e.add.sprite(t.x,t.y,"right_textbox"),r=e.add.sprite(t.x-19*o,t.y,"left_textbox");n.add(r);for(var i=1;o>i;i++){var s=e.add.sprite(t.x-19*i,t.y,"middle_textbox");n.add(s)}return n.add(a),n}var n=75,a={font:"20px yoster_islandregular",fill:"0x000000",align:"left"},r=this,i=!1,s=[],d=[];e.eventManager.register(e.Events.DAY.END,t),this.populateQuestions=function(n,i){t(),s=Object.keys(n);for(var l=function(t,o){t.events.onInputOver.add(function(){t.fill="#d3af7a"},this),t.events.onInputOut.add(function(){t.fill="#000000"},this),t.events.onInputDown.add(function(){y("QUESTION SELECTED: "+o),e.eventManager.notify(e.Events.INPUT.QUESTION,o),r.hideQuestions()},this)},u=0;u<s.length;u++){y("QUESTION OPT: "+s[u]);var f=e.add.text(775,835," "+n[s[u]]+" ",a,i);f.anchor.setTo(1,1),f.inputEnabled=!0,d.push(f),l(d[u],s[u]),f.textbox=o(f)}for(var c=e.add.group(),u=0;u<d.length;u++)c.add(d[u]);e.depthGroups.questionGroup.add(c)},this.toggleQuestions=function(){if(i=!i,y("QUESTIONS TOGGLE: size["+d.length+"]"),i)for(var t=0;t<d.length;t++){var o=-400-(t+1)*n;d[t].textbox.forEach(function(t){var n=e.add.tween(t).to({y:(o-35).toString()},200,Phaser.Easing.Quadratic.Out);n.start()});var a=e.add.tween(d[t]).to({y:o.toString()},200,Phaser.Easing.Quadratic.Out);a.start()}else for(var t=0;t<d.length;t++){d[t].textbox.forEach(function(t){var o=e.add.tween(t).to({y:835},200,Phaser.Easing.Quadratic.Out);o.start()});var a=e.add.tween(d[t]).to({y:835},200,Phaser.Easing.Quadratic.Out);a.start()}},this.hideQuestions=function(){if(i)for(var t=0;t<d.length;t++){var o=e.add.tween(d[t]).to({y:835},200,Phaser.Easing.Quadratic.Out);o.start(),d[t].textbox.forEach(function(t){var o=e.add.tween(t).to({y:835},200,Phaser.Easing.Quadratic.Out);o.start()})}i=!1}}function S(e){function t(e){e.indexOf("shop")>=0&&(u+=.1/3)}function o(e){var t=0;for(var o in e)t+=e[o].priority||0;var n=Math.random()*t,a=0;for(var o in e)if(a+=e[o].priority||0,a>n)return o;return"INVALID ITEM"}function n(e,t){var o=[],n=e[t].min,a=e[t].max+1,r=Math.ceil((n+a)/2),i=Math.ceil((r+a)/2);for(f(.8)?o.push(p(n,r)):f(.8)?o.push(p(r,i)):o.push(p(i,a));o[o.length-1]<a;){var s=(a-o[o.length-1])/(a-n);if(s=Math.min(.6+u,3*Math.pow(s,3)),!f(s))break;f(.7)?o.push(p(o[o.length-1]+1,i)):o.push(p(o[o.length-1]+1,a))}return o}z=function(e,t){t=t||{};var r=t.item||o(e.itemData),i=t.offers||n(e.itemData,r);return{type:"interact",appearanceInfo:t.appearanceInfo||a(r,i),item:r,offers:i,offerText:t.offerText||B(r,i),success:t.success||d(),fail:t.fail||l(),questions:t.questions||s(e),appearConditions:t.appearConditions||!1,sellConditions:t.sellConditions||!1,refuseConditions:t.refuseConditions||!1,stallTime:t.stallTime||!1,stallConditions:t.stallConditions||!1,isHero:t.isHero||!1,isFalseHero:t.isFalseHero||!1}};var a,r,i,s,d,l,u=0;e.eventManager.register(e.Events.LEVEL.ACCEPT,t),B=function(e,t){var o=[];o.push(r(e,t[0]));for(var n=1;n<t.length;n++)o.push(i(t[n]));return o}.bind(this),function(){var t=e.assetManager.assets.npc;a=function(o,n){var a=(Math.max.apply(this,n),"");for(var r in t)if("hand"!=r){var i=e.assetManager.assets.npc[r];a+=r+"|"+e.rnd.integerInRange(1,i)+","}var s=_();return a+="skin|("+s.r.toFixed(2)+","+s.g.toFixed(2)+","+s.b.toFixed(2)+")"},q=function(e){e.appearanceInfo=a(e.item,e.offers)}}(),function(){var e=["Can I get [x] for [y] gold?","Could I get [x] for [y] gold?","How's [y] gold for [x] sound?","Would you part with [x] for [y] gold?","Can I get [x]? [Y] gold.","Need [x]. [Y] gold?"],t=["Hiya! ","Howdy! ","How's it going?/","Nice day out!/"];r=function(o,n){o=o||"ERROR",n=m(n)||"ERROR",o=v(o);var a=Math.floor(Math.random()*t.length),r=Math.random()<.5?t[a]:"";a=Math.floor(Math.random()*e.length);var i=e[a],s="string"==typeof n?n.charAt(0).toUpperCase()+n.slice(1):n;return r+i.replace("[x]",o).replace("[y]",n).replace("[Y]",s)}}(),function(){var e=["Alright, you got me. [X] gold?","Fine, fine. [X] gold?","Alright, alright. [X] gold?","How about [x] gold?","[X] gold is the best I can do."];i=function(t){t=m(t)||"ERROR";var o="string"==typeof t?t.charAt(0).toUpperCase()+t.slice(1):t,n=Math.floor(Math.random()*e.length);return e[n].replace("[x]",t).replace("[X]",o)}}(),function(){function e(e){var o=t[e];if(!o)return"ERROR";var n=Math.floor(Math.random()*o.length);return o[n]}var t={day:["Um, good?","Not particularly exciting.","None of your business.","Not bad.","Eh.","Meh.","Pretty alright.","What's it to you?","Why do you care?","Boring."],news:["I don't get out much.","No idea.","Probably some new cataclysm. We seem to get a lot of them.","Dunno.","Your shop opened? That's sort of news.","I'm still alive. News enough for me.","You probably know more than I do."],color:["Red.","Blue?","Chartreuse. @@@Don't you dare judge me.","0x@8B@A8@70","Purple.","Sky color.","Ground color.","The color of apples.","Goldenrod.","Pewter.","Cerulean.","Fuscia.","Viridian.","Vermillion.","Cinnibar.","Saffron."],number:["Seven.","Six.","Negative one.","Zero.","Pi.","i","Fourty seven.","Ninety three.","Sixty two.","One hundred.","What a strange question.","I guess I've never given that much thought...","What's it to you?"]};s=function(t){var o=t.questions,n={};for(var a in o)n[a]=e(a);return n}}(),function(){var e=["Pleasure doing business.","Thanks! I needed this.","Thanks a bunch, friend.","Thank you!","Thanks, see ya!","Thanks.","You're the best, pal."];d=function(){var t=Math.floor(Math.random()*e.length);return e[t]}}(),function(){var e=["Heh, good luck getting more than that.","Seriously, more? No way.","You just lost my business.","There's no way I can afford more.","Terrible experience. Zero stars.","This is a disappointment.","Do I look rich to you?"];l=function(){var t=Math.floor(Math.random()*e.length);return e[t]}}()}function C(e){function t(){i=[];for(var e=u,t=0;s>t;t++){var o=b(e);e=e.filter(function(e){return e!==o&&c[o].invalidOthers.indexOf(e)<0}),y("STORY: "+o),i.push(o)}for(var n=f,a=0;d>a;a++){var o=b(n);n=n.filter(function(e){return e!==o&&c[o].invalidOthers.indexOf(e)<0}),i.push(o)}}function o(e,t,o,a){for(var r=e.sequence,i=n(r,o.length),s=0;s<o.length;s++){var d;if(a){var l=Math.floor(i.length/(o.length-s)),u=i.slice(0,l);d=b(u),i=i.slice(u.indexOf(d)+1)}else d=b(i,!0);r[d]=I(t,o[s])}}function n(e,t){for(var o=[],n=0;o.length<2*t&&l>n;n++)e[n]||o.push(n);return o}function a(e,t){if(t)for(var o in t)e.conditions[o]=t[o]}function r(e,t){if(t)for(var o=0;o<t.length;o++)e.wrapup.push(t[o])}var i,s=2,d=0,l=30;this.garnishDay=function(e,t){for(var n=0;n<i.length;n++){var s=c[i[n]],d=s[t];d&&(o(e,i[n],d.chars,d.isOrdered),a(e,d.conditions),r(e,d.wrapup))}};var u=["uprising","urchin","treasure","artifact"],f=[],c={urchin:{1:{chars:["1scaredMan","1trackerSearch","1trackerWarn"],isOrdered:!0,conditions:{urchin_manGrateful:{components:["urchin_manLived"],chance:1,isLongTerm:!0},urchin_manWary:{components:["urchin_manRefused"],chance:1,isLongTerm:!0},urchin_familyAngry:{components:["urchin_manDead"],chance:1,isLongTerm:!0}},wrapup:[{conditions:["manGrateful"],text:"You think you feel a presence nearby while you're sleeping, but you can't be sure."}]},2:{chars:["2gratefulMan","2angryFamily"],isOrdered:!1,conditions:{urchin_manWary:{components:["urchin_refusedGift"],chance:1,isLongTerm:!0},urchin_trackerSuspicious:{components:["urchin_acceptedGift"],chance:1,isLongTerm:!0}},wrapup:[{conditions:["urchin_familyAngry"],text:"You feel a hostile presence watching you as you sleep."}]},4:{chars:["4tracker","4waryMan","4trackerWarning"],isOrdered:!1,conditions:{urchin_trackerMad:{components:["urchin_trackerTruth"],chance:.8,isLongTerm:!0},urchin_trackerVengeful:{components:["urchin_trackerLied"],chance:.4,isLongTerm:!0}},wrapup:[{conditions:["urchin_unprotected"],text:"You feel the presence again in the night, though this time it slices your arm with a blade. You pay the town doctor 13 gold.",gold:-13},{conditions:["urchin_trackerProtect"],text:"You feel the presence again in the night. A shadowy figure pounces on you, but your protector drives it away."}]},5:{chars:["5waryManTest","5madTracker"],isOrdered:!1,conditions:{urchin_trackerVengeful:{components:["urchin_trackerRefused"],chance:.6,isLongTerm:!0},urchin_manProud:{components:["urchin_manSold"],chance:1,isLongTerm:!0}}},6:{chars:["6proudMan","6vengefulTracker"],isOrdered:!1},invalidOthers:["treasure","artifact"]},treasure:{2:{chars:["2offer"],isOrdered:!1,conditions:{treasure_happy:{components:["treasure_bought"],chance:1,isLongTerm:!0},treasure_sad:{components:["treasure_refused"],chance:1,isLongTerm:!0},treasure_good:{components:["treasure_bought"],chance:.75,isLongTerm:!1}},wrapup:[{conditions:["treasure_bought"],text:"At nightfall, you set out to follow your new treasure map, but you can't seem to find anything."},{conditions:["treasure_good"],text:"Just as you're about to leave, you spot a stack of 12 gold!",gold:12}]},3:{chars:["3friendlyOffer","3sadOffer"],isOrdered:!1,conditions:{treasure_hunting:{components:["treasure_bought","treasure_happy"],chance:1,isLongTerm:!0},treasure_sad:{components:["treasure_refused"],chance:1,isLongTerm:!0},treasure_good:{components:["treasure_bought"],chance:.75,isLongTerm:!1}},wrapup:[{conditions:["treasure_bought"],text:"At nightfall, you set out to follow your new treasure map, but you can't seem to find anything."},{conditions:["treasure_good"],text:"Just as you're about to leave, you spot a stack of 18 gold!",gold:18}]},4:{chars:["4dungeonOffer","4lastMap"],conditions:{treasure_hunting2:{components:["treasure_bought","treasure_hunting"],chance:1,isLongTerm:!0},treasure_good:{components:["treasure_bought"],chance:.75,isLongTerm:!1}},wrapup:[{conditions:["treasure_bought"],text:"At nightfall, you set out to follow this last treasure map, but you can't seem to find anything."},{conditions:["treasure_good"],text:"That is, until you spot a stack of 20 gold!",gold:20}]},6:{chars:["6goodbye"],isOrdered:!1},invalidOthers:["urchin","artifact"]},artifact:{1:{chars:["1initialGive"],isOrdered:!1,wrapup:[{text:"Looking at the orb makes your innards feel strange./@@@@You cover it with a blanket."}]},2:{chars:["2shinyOffer"],isOrdered:!1,conditions:{artifact_haveOrb2:{components:["artifact_keptOrb"],chance:1,isLongTerm:!0},artifact_lostOrb:{components:["artifact_soldOrb"],chance:1,isLongTerm:!0}}},3:{chars:["3studyOffer"],isOrdered:!1,conditions:{artifact_haveOrb3:{components:["artifact_keptOrb"],chance:1,isLongTerm:!0},artifact_lostOrb:{components:["artifact_soldOrb"],chance:1,isLongTerm:!0}}},4:{chars:["4collectorOffer"],isOrdered:!1,conditions:{artifact_haveOrb4:{components:["artifact_keptOrb"],chance:1,isLongTerm:!0},artifact_lostOrb:{components:["artifact_soldOrb"],chance:1,isLongTerm:!0}}},5:{chars:["5villainOffer"],isOrdered:!1,conditions:{artifact_haveOrb5:{components:["artifact_keptOrb"],chance:1,isLongTerm:!0},artifact_villainOrb:{components:["artifact_soldOrb"],chance:1,isLongTerm:!0}}},6:{chars:["6returnHappy","6returnSad","6returnScared"],isOrdered:!1,wrapup:[{conditions:["haveOrb5"],text:"As the sun sets, you feel a wave of the orb's energy and see a beam of light pierce the sky in the north."},{conditions:["haveOrb5"],text:"The slightly charred keeper of the orb stops by your home, and gives his thanks along with 20 more gold.",gold:20},{conditions:["artifact_villainOrb"],text:"As the sun sets, you feel a wave of the orb's energy and see a beam of light pierce the sky in the north."},{conditions:["artifact_villainOrb"],text:"From the beam's direction, shadows creep into the land, destroying all that they touch, including your storefront.",gold:-30}]},invalidOthers:["treasure","urchin"]},uprising:{2:{chars:["2intro"],isOrdered:!1},3:{chars:["3return"],isOrdered:!1,conditions:{uprising_rebelBegin:{components:["uprising_rebel"],chance:1,isLongTerm:!0},uprising_citizenBegin:{components:["uprising_citizen"],chance:1,isLongTerm:!0}}},4:{chars:["4policeIntro","4rebelMoney"],isOrdered:!0,conditions:{uprising_rebelJoined:{components:["uprising_rebel"],chance:1,isLongTerm:!0},uprising_citizenBegin:{components:["uprising_citizen"],chance:1,isLongTerm:!0}},wrapup:[{conditions:["uprising_rebel"],text:"You hear whispers of a rebellion gathering money and strength within the town."}]},5:{chars:["5rebelWarning","5rebelJob","5official","5policeAsk","5stallThanks"],isOrdered:!0,conditions:{uprising_traitorFound:{components:["uprising_traitor"],chance:.5,isLongTerm:!0},uprising_informantHelper:{components:["uprising_informant"],chance:1,isLongTerm:!0}},wrapup:[{conditions:["uprising_citizenBegin"],text:"A small and harmless, but frightening fire broke out in the town square. The police refuse to comment on who they believe was responsible."},{conditions:["uprising_officialStalled"],text:"You hear that an important city official has gone missing."}]},6:{chars:["6stallAsk","6rebelStall","6policeBribe"],isOrdered:!0,wrapup:[{text:"Even more instructions on how to join the rebellion are slipped under your door just before nightfall."},{conditions:["uprising_informant"],text:"However, later in the night, the police stop by to thank you for destroying the rebellion. They leave behind a generous tip.",gold:20}]},invalidOthers:[]}};t()}function A(e){function t(){u.randomGenHero=J(),l=Object.keys(u)}function o(e,t,o){var n=b(o,!0),a=u[t].hero;e.sequence[n]=I(t,a)}function n(e,t,o,n){for(var a=c(u[t].falseHeroes),r=0;r<Math.min(a.length,n);r++){var i=b(o,!0),s=b(a,!0);e.sequence[i]=I(t,s)}}function a(e,t){for(var o=u[t].wrapup,n=0;n<o.length;n++)e.wrapup.push(o[n])}function r(e,t){for(var o=u[t].clues,n=0;n<o.length;n++)e.clues.hero.push(o[n])}function i(e,t){var o=u[t].questions;for(var n in o)e.questions[n]=o[n]}function s(e){for(var t=[],o=0;d>o;o++)e[o]||t.push(o);return t}G(e);var d=20,l=[];this.insertHeroes=function(e,t){var d=b(l,!0),u=s(e.sequence);o(e,d,u),n(e,d,u,t),r(e,d),i(e,d),a(e,d)};var u={vocabMan:{hero:"hero",falseHeroes:["villain"],clues:["The hero knows only four words."],questions:{number:"Favorite number?",color:"Favorite color?"},wrapup:[{conditions:["soldHero"],text:"Using his sharpshooting skills, the hero drove the monsters from the town."},{conditions:["soldHero"],text:"When interviewed, he would only repeat 'BOW GET, FIVE GOLD!'."},{conditions:["refusedHero"],text:"Without the hero to drive them away, the monsters pillage the town and destroy your storefront. You spend 15 gold to repair it.",gold:-15}]},stutterMan:{hero:"hero",falseHeroes:["villain1","villain2","villain3"],clues:['The hero has a hard time with the "s" sound. Be patient, he might take a while to pronounce sssssnake',"The hero does not know the difference between numbers"],questions:{numbers:"Two plus two?",animal:"Snakes?"},wrapup:[{conditions:["soldHero"],text:"Our hero slayed the enemies while screaming SSSSSnakessssss are not SSSSScary!\nHe stopped by your store to give you a small tip of 1 gold. You helped him overcome his secret fear of snakes he didn't know he had ...",gold:1},{conditions:["soldHero"],text:"Our hero couldn't stop hissing. Or shushing? Can't really tell ... Maybe someone forgot to reset him?"},{conditions:["soldHero"],text:"When asked how many he had slain, our hero said 'Two plussssss two many! Ssssssso around 10.4 I would guesssssssss'. He's not our brightest hero"},{conditions:["refusedHero"],text:"Our hero was found in the local town pub talking about how he 'would have' saved the villiage if a 'ccccccertain ssssssssomeone' would have sold him a shield. The townspeople wept and a couple of them joined forces and trashed your shop. You spent 10 gold in repairs.",gold:-10}]},stallingMan:{hero:"hero",falseHeroes:["villain1","villain2"],clues:["The hero speaks in bursts of three words","The hero cannot pronounce 'supercalifragilistic\nexpialidocious'","Our hero does not know what a sword is. But he will want to buy one","Our hero has no money, he will ask for the sword for free"],questions:{sword:"Sword?","super":"Supercalifragilisticexpialidocious?"},wrapup:[{conditions:["soldHero"],text:"Our hero stormed into battle in a gallop and slayed the enemies with a quick 1,2,3 of the sword.\nNow that he has some money, he stops by and thanks you by giving you 1 gold out of his overflowing gold bag.",gold:1},{conditions:["soldHero"],text:"Our ran to the front lines and drew his shiny new (free) sword. Everyone cowered in fear and fled. Unfortunatley, our hero didn't make any money because of it. So he is still goldless :("},{conditions:["soldHero"],text:"When interviewed, our hero could not stop talking about his supercallfraglisticous pointy thing that he used so well"},{conditions:["refusedHero"],text:"Our hero thought that a stick on the ground would be suitible to fend off the enemies. It didn't work. King Zoran took an extra 15 gold in taxes to repair the town after the ransacking.",gold:-15}]},rhymeAdvance:{hero:"hero",falseHeroes:["falseHero1","falseHero2","falseHero3"],clues:["The first, seventh, and thirteenth word the hero says will rhyme."],questions:{day:"How was day?",color:"Favorite Color?"},wrapup:[{conditions:["soldHero"],text:"Using their newly purchased shield to cower behind, the hero was able to confuse and defeat the monsters with their rhymes."},{conditions:["soldHero"],text:"In appreciation, they return with some of the monster's keep.",gold:5},{conditions:["refusedHero"],text:"Without a shield, the hero was lost while trying to distract the monsters with their rhymes./@Your store is pillaged.",gold:-12}]}};t()}function P(e){function t(e){var t=b(Object.keys($.jeffPoolStart));return I("jeffPoolStart",t)}function o(e){var t=b(Object.keys($.jeffPoolEnd));return I("jeffPoolEnd",t)}this.insertJeff=function(e,n){e.sequence[0]=t(n),e.sequence[9999]=o(n)}}function G(e){function t(e,t,n,a){var r=t.offerText[0].split(/[^a-zA-Z]/).join(""),i=Math.floor(Math.random()*r.length),s=i,d=r.charAt(i);if(a)for(var l=0;l<n.length;l++){var u=n[l].offerText[0].split(/[^a-zA-Z]/).join(""),f=u.charAt(i);if(f===d){if(i=(i+1)%r.length,i===s)return;d=r.charAt(i),l=0}}e.clues.push(o(d,i))}function o(e,t){t+=1;var o="The "+k(t)+" letter the hero says will be '"+e+"'.";return o}var n=2;J=function(e){for(var o={hero:"hero",falseHeroes:[],clues:[],questions:{},itemData:{sword:{min:2,max:11,priority:5},chicken:{min:1,max:9,priority:2}}},s=z(o,{sellConditions:["soldHero"],refuseConditions:["refusedHero"],isHero:!0}),d=[],l=0;n>l;l++)d.push(z(o,{sellConditions:["soldFalse"],isFalseHero:!0}));a(o,s,d,!1),r(o,s,d,!1),t(o,s,d,!0),i(o),delete o.itemData,$.randomGenHero.hero=s;for(var l=0;n>l;l++)o.falseHeroes.push("falseHero"+l),$.randomGenHero["falseHero"+l]=d[l];return o};var a,r,i;!function(){i=function(e){e.wrapup=[{conditions:["soldHero"],text:"Thanks to your help, the hero saves the town. In thanks, the hero brings you some of the cash he won and said more bland randomly generated things.",gold:5},{conditions:["refusedHero"],text:"Unfortunately, without your help, the very bland hero was unable to stop the threat. Your store was pillaged in the night.",gold:-10}]}}(),function(){function e(e){for(var t=w(Object.keys(r)).slice(0,2),o=0;o<t.length;o++)e.questions[t[o]]=r[t[o]];return t}function t(e,t){var o="";if(t&&t.length>=s[e].length)return"NOT ENOUGH OPTIONS FOR UNIQUE";do o=b(s[e]);while(t&&t.indexOf(o)>=0);return o}function o(e,t){return b(i[e]).replace("[x]",t)}function n(e,t){return b(d[e]).replace("[x]",t)}var r={day:"How was day?",color:"Favorite color?",number:"Favorite number?"},i={day:["Ah, it was [x].","It was [x].","My day was [x].","My day? It was [x].","Just like every other day. It was [x]."],color:["The best color is obviously [x].","My favorite color? Definitely [x].","My favorite color is [x].","Easily [x]."],number:["My favorite number is [x].","The best number is [x].","I have to go with [x].","Easily [x]."]},s={day:["'well'","alright, I guess","not bad, could've been better","good, good...","a complete disaster","'really normal'","'smelly'"],color:["'Mac and Cheese'","the color of worms","'Royal Purple'","'Radical Red'","'Outrageous Orange'","'Razzle Dazzle Rose'","'Purple Pizzazz'","'Magic Mint'","'Screamin' Green'"],number:["negative twelve","banana","fourty","sixty two","eight hundred","seven point nine two six two eight nine five","twoteen","seven-eleven"]},d={day:["The hero will say their day was [x].","The hero's day has been [x]."],color:["The hero's favorite color is [x]."],number:["The hero's favorite number is [x]."]};a=function(a,r,i,s){for(var d=e(a),l=Math.floor(Math.random()*d.length),u=0;u<d.length;u++){var f=[],c=d[u],h=t(c);u===l&&(s&&f.push(h),a.clues.push(n(c,h))),r.questions[c]=o(c,h);for(var p=0;p<i.length;p++){var g=t(c,f);i[p].questions[c]=o(c,g)}}}}(),function(){function e(e){for(var t=[],o=0;e>o;o++){var n=Math.floor(3*Math.random());t.push(e+n-o)}return t}function t(e,t){var n=b(o);return n.replace("[n]",T(t)).replace("[x]",m(e))}var o=["The hero's [n] offer will be [x] gold."];r=function(o,n,a,r){var i=f(.6)?1:f(.625)?2:f(10/15)?3:4;if(n.offers=e(i),n.offerText=B(n.item,n.offers),o.clues.push(t(n.offers[i-1],i)),r)for(var s=0;s<a.length;s++){var d=a[s].offers[i-1];d&&d===n.offers[i-1]&&(a[s].offers[i-1]-=1)}}}()}function N(e){function t(e,t){for(var o=0;o<t.items.length;o++){var n=t.items[o];e.itemData[n]={min:Math.floor(X[n].price/2),max:Math.ceil(2*X[n].price),priority:100/(o+1)}}}function o(e){e.length=5e4}var n,a=new A(e),r=new C(e),i=new P(e);V=function(e){var u=n[e]?n[e]:c(l);if(u.isPreset.length||o(u),!u.isPreset.items){var f=s(u);t(u,f)}return u.isPreset.tax||d(u,e),u.isPreset.jeff||i.insertJeff(u,e),u.isPreset.hero||a.insertHeroes(u,Math.ceil(e/3)),u.isPreset.plot||r.garnishDay(u,e),u};var s,d;!function(){function t(){return w(e.playerState.getAvalItems())}function o(){return b(d)}function n(e){return b(l).replace("[x]",e)}function a(e){var t=b(u);return t.replace("[ax]",v(e)).replace("[x]",e)}var r=3,i=2,d=["goblins","escaped convicts","ruffians","violent youths","orcs","beholders","inedible mushroom monsters","ill-mannered honey badgers"],l=["The town is being menaced by [x].","Our town's being attacked by [x].","Your shop is being threatened by [x]","The town is imperiled by [x]"],u=["People seem to really want [x]s.","The townspeople are clamoring for [x]s.","Everyone in town wants [ax].","[x]s have been in high demand.","People are searching for [x]s"];s=function(e){var s={threat:o(),items:t().slice(0,r)};e.clues.crisis.push(n(s.threat));for(var d=0;i>d;d++)e.clues.crisis.push(a(s.items[d]));return s}}(),function(){function e(e,t,o){return{text:e,gold:t,conditions:o}}d=function(t,o){var n=10*Math.ceil((1+o)/4),a=10*Math.ceil((2+o)/4);t.wrapup.push(e("You are forced by King Zoran to pay "+n+" gold in taxes.",-n)),n!==a&&t.wrapup.push(e("You are warned that tomorrow, Zoran will want "+a+" gold."))}}();var l={isPreset:{},itemData:{},sequence:{},conditions:{},clues:{hero:[],crisis:[]},questions:{},wrapup:[]};n=[{itemData:{sword:{min:2,max:11,priority:5}},isPreset:{length:!0,items:!0,tax:!0,jeff:!0,hero:!0,plot:!0},sequence:{0:{category:"dayOne",hero:"introJeff",fuzz:0,force:!0},1:{hero:{item:"sword",offers:[7]},fuzz:0,force:!0},2:{hero:{item:"sword",offers:[1,8],sellConditions:["tutorialFailed"],refuseConditions:["tutorialFailed"]},fuzz:0,force:!0},3:{category:"dayOne",hero:"messUpJeff",fuzz:0,force:!0},4:{category:"dayOne",hero:"tutorialWoman",fuzz:0,force:!0},6:{hero:{item:"chicken",offers:[3,6],sellConditions:["soldChicken"]},fuzz:0,force:!0},7:{category:"dayOne",hero:"chickenJeff",fuzz:0,force:!0},8:{category:"dayOne",hero:"badCousin",fuzz:3,force:!0},11:{category:"dayOne",hero:"tutorialWomanAngry",fuzz:3,force:!0},12:{category:"dayOne",hero:"tutorialWomanHappy",fuzz:3,force:!0},9999:{category:"dayOne",hero:"endOfTutorialJeff",fuzz:0,force:!0}},conditions:{tutorialItemGive:{components:["tutorialBegin"],chance:1,events:["Events.TUTORIAL.BEGIN"],isLongTerm:!1},dayOneRobbery:{components:["soldCousin"],chance:1,isLongTerm:!0},uglyHackTracking:{components:["tutorialFailed"],chance:1,events:["Events.TUTORIAL.FAILED"],isLongTerm:!1}},clues:{hero:["My cousin is rather rude.","My cousin's favorite color is 'Mac and Cheese'"],crisis:[""]},questions:{day:"How was your day?",color:"Favorite color?"},wrapup:[{text:"You're forced by King Zoran to pay 10 gold in taxes.",gold:-10},{conditions:["soldCousin"],text:"Your store is robbed in the night. The robber leaves a note on Mac and Cheese colored paper.",gold:-3}],length:4e4},{isPreset:{length:!0,items:!0,tax:!0,jeff:!0,hero:!0,plot:!1},itemData:{sword:{min:2,max:11,priority:5},chicken:{min:1,max:9,priority:2}},sequence:{0:{category:"dayTwo",hero:"introJeff",fuzz:0,force:!0},4:{category:"dayTwo",hero:"rhymeMan",fuzz:7,force:!0},6:{category:"dayTwo",hero:"badRhymeMan",fuzz:7,force:!1},9999:{category:"dayTwo",hero:"endJeff",fuzz:0,force:!0}},conditions:{},clues:{hero:["The hero speaks only in rhyme.","The hero does not use made up words to force a rhyme."],crisis:["Goblins have been harassing townspeople.","As a result, swords are in high demand."]},questions:{day:"How was your day?",color:"Favorite color?"},wrapup:[{text:"You're forced by King Zoran to pay 10 gold in taxes.",gold:-10},{conditions:["soldHero"],text:"Thanks to the sword you sold to the hero, goblins are driven from the town."
},{conditions:["refusedHero"],text:"Unfortunately, the hero did not have a sword and the town was overrun by goblins. Your store was pillaged in the night.",gold:-20},{conditions:["soldFalse"],text:"After giving a discount to the fake hero, you're getting a reputation around town. You might see some more people looking for hero discounts."}],length:6e4},{isPreset:{length:!0,items:!0,tax:!0,jeff:!0,hero:!1,plot:!1},itemData:{sword:{min:2,max:11,priority:2},chicken:{min:1,max:8,priority:2},bow:{min:3,max:12,priority:8}},sequence:{0:{category:"dayThree",hero:"introJeff",fuzz:0,force:!0},6:{category:"dayThree",hero:"startDog",fuzz:0,force:!0},7:{category:"dayThree",hero:"jeffDog",fuzz:0,force:!0},8:{category:"dayThree",hero:"dogChoice",fuzz:0,force:!0},9:{category:"dayThree",hero:"jeffHappy",fuzz:0,force:!0},9999:{category:"dayThree",hero:"endJeff",fuzz:0,force:!0}},conditions:{dogAppear:{components:["gotDog"],events:["Events.DOG.APPEAR"],chance:1,isLongTerm:!0}},clues:{hero:[],crisis:["The town's being attacked by convicts with very short swords.","Bows are in high demand."]},questions:{},wrapup:[{text:"You're forced by King Zoran to pay 10 gold in taxes.",gold:-10}],length:6e4},!1,!1,!1,!1,{isPreset:{length:!0,items:!1,tax:!0,jeff:!0,hero:!0,plot:!0},itemData:{},sequence:{0:{category:"finalDay",hero:"introJeff",fuzz:0,force:!0},1:{category:"finalDay",hero:"introZoran",fuzz:0,force:!0},9999:{category:"finalDay",hero:"endZoran",fuzz:0,force:!0}},clues:{hero:["Today, you are the hero."],crisis:[]},questions:{},wrapup:[],length:8e4}]}function D(e){function t(e,t,o,n,a,r){e.text="",e.position.y=e.defaultY;var i=0,s=r.split("/");i+=s.length;for(var d=0;d<s.length;d++){t.text="";for(var l=s[d].split(" "),u=0;u<l.length;u++)t.text+=l[u]+" ",t.width>o&&(l[u-1]+="|",i++,t.text=l[u]+" ");s[d]=l.join(" ")}return e.position.y+=(n-i)*(a/2),s.join("/").split("| ").join("|")}function o(e,t,o,n,a,r,i){isPrinting=!0,e.text="";var s=function(t,a){if(a<t.length){var d;"/"===t[a]?(e.text=e.text+"\n",d=n):"|"===t[a]?(e.text=e.text+"\n",d=0):"@"===t[a]?d=n:(e.text=e.text+t[a],d=","==t[a]||"."==t[a]||"?"==t[a]?n:o),r.timeout=setTimeout(function(){s(t,a+1)},d)}else i()};s(t,0)}e.dialog={main:{box:e.add.text(250,427,"",{font:"24px yoster_islandregular",fill:K.PassiveMain}),ghost:e.add.text(999,999,"",{font:"24px yoster_islandregular"}),isPrinting:!1,isFrozen:!1,freeze:function(e){e?this.isFrozen=!0:(this.isFrozen=!1,this.unfreezeCallback&&this.unfreezeCallback())},message:!1,timeout:!1,callback:!1,unfreezeCallback:!1},jeff:{box:e.add.text(560,70,"",{font:"16px yoster_islandregular",fill:K.PassiveDarker}),ghost:e.add.text(999,999,"",{font:"16px yoster_islandregular"}),timeout:!1},dog:{box:e.add.text(300,130,"",{font:"16px yoster_islandregular",fill:K.PassiveDarker}),ghost:e.add.text(999,999,"",{font:"16px yoster_islandregular"}),timeout:!1},wrapup:{box:e.add.text(150,300,"",{font:"24px yoster_islandregular",fill:K.PassiveLighter}),ghost:e.add.text(999,999,"",{font:"24px yoster_islandregular"}),timeout:!1}},e.depthGroups.shopGroup.add(e.dialog.jeff.box),e.dialog.main.box.defaultY=427,e.dialog.jeff.box.defaultY=130,e.dialog.wrapup.box.defaultY=300,this.printWrapup=function(n,a){a=a||function(){},clearTimeout(e.dialog.wrapup.timeout);var r=t(e.dialog.wrapup.box,e.dialog.wrapup.ghost,500,5,30,n);o(e.dialog.wrapup.box,r,10,100,!1,e.dialog.wrapup,a)},this.printMain=function(n,a,r){r=r||function(){};var i=function(){r(),e.analytics.track("text","noSkipText")};clearTimeout(e.dialog.main.timeout);var s=t(e.dialog.main.box,e.dialog.main.ghost,383,5,30,n);e.dialog.main.message=s,e.dialog.main.callback=r;var d=function(){a?o(e.dialog.main.box,s,0,0,!1,e.dialog.main,r):o(e.dialog.main.box,s,15,150,!1,e.dialog.main,i),e.dialog.main.unfreezeCallback=!1};e.dialog.main.isFrozen?e.dialog.main.unfreezeCallback=d:d()},this.jumpMain=function(){e.analytics.track("text","skipText");var t=e.dialog.main.message.split("@").join("").split(/\/|\|/);clearTimeout(e.dialog.main.timeout),e.dialog.main.box.text=t.join("\n"),e.dialog.main.callback()};var n=!1;this.printJeff=function(a,r){if(r=r||function(){},""===a)return n=!1,clearTimeout(e.dialog.jeff.timeout),e.dialog.jeff.box.text="",e.displayManager.clearJeffDialog(),void r();var i=function(){clearTimeout(e.dialog.jeff.timeout);var n=t(e.dialog.jeff.box,e.dialog.jeff.ghost,180,3,23,a);o(e.dialog.jeff.box,n,15,100,!1,e.dialog.jeff,r)};n?i():(e.displayManager.putJeffDialog(550,70,200,180,i),n=!0)},this.printDog=function(n,a){a=a||function(){},clearTimeout(e.dialog.dog.timeout);var r=t(e.dialog.dog.box,e.dialog.dog.ghost,230,4,23,n);o(e.dialog.dog.box,r,15,100,!1,e.dialog.dog,a)}}function R(e){function t(){T=1,e.eventManager.register(e.Events.INPUT.CONTINUE,function(){if(g&&"interact"===g.type)s(g,v,!0);else if(g&&"dialog"===g.type&&("string"==typeof g.dialog&&0==w||g.dialog instanceof Array&&w<g.dialog.length))d(g,w),w++;else{if(g){if(e.dayTimer.resume(),g.finishConditions)for(var t=0;t<g.finishConditions.length;t++)_.set(g.finishConditions[t]);g.endMoney&&e.eventManager.notify(e.Events.INVENTORY.SOLD,"None",g.endMoney)}a()}}),e.eventManager.register(e.Events.LEVEL.ACCEPT,function(e){e.indexOf("time")>=0&&(T+=.05)}),e.eventManager.register(e.Events.INPUT.YES,function(){e.eventManager.notify(e.Events.INVENTORY.SOLD,g.item,g.offers[v]);var t=g.sellConditions;if(t)for(var o=0;o<t.length;o++)_.set(t[o]);g.isHero&&e.analytics.track("hero","sold_good"+u),g.isFalseHero&&e.analytics.track("hero","sold_bad"+u),e.eventManager.notify(e.Events.INTERACT.DIALOG,l(g,"success")),g=!1}),e.eventManager.register(e.Events.INPUT.NO,function(){e.analytics.track("NOTSOLD",g.item,g.offers[v]);g.offers;if(v++,g.offers.length>v)s(g,v);else{var t=g.refuseConditions;if(t)for(var o=0;o<t.length;o++)_.set(t[o]);g.isHero&&e.analytics.track("hero","refused_good"+u),g.isFalseHero&&e.analytics.track("hero","refused_bad"+u),e.eventManager.notify(e.Events.INVENTORY.NOTSOLD,g.item,g.offers[v]),e.eventManager.notify(e.Events.INTERACT.DIALOG,l(g,"fail")),e.eventManager.notify(e.Events.TIMER.JUMP,1e3),g=!1}}),e.eventManager.register(e.Events.INPUT.QUESTION,function(t){e.eventManager.notify(e.Events.INTERACT.DIALOG,l(g.questions,t))}),e.eventManager.register(e.Events.INPUT.ITEM,function(t){e.eventManager.notify(e.Events.INTERACT.DIALOG,l(g.items,t))}),e.eventManager.register(e.Events.INPUT.PROFILE,function(t){e.eventManager.notify(e.Events.INTERACT.DIALOG,l(g.profiles,t))}),e.eventManager.register(e.Events.TIMER.JUMP,function(t){e.dayTimer.jumpForward(t)}),e.reset.register(function(){e.dayTimer&&e.dayTimer.pause()})}function o(e){h={};var t=e.sequence,o={};for(var n in t)0===t[n].fuzz?h[n]=t[n]:o[n]=t[n];for(var n in o){var a,r=0;do r>=2*o[n].fuzz&&(o[n].fuzz++,r=0),n=parseInt(n),a=n+Math.floor(Math.random()*o[n].fuzz),r++;while(h[a]);h[a]=o[n]}}function n(){var e=h[p],t=!1;if(e&&(t=e.category?$[e.category][e.hero]:$[e.hero]),p++,c){for(var o=Math.max.apply(this,Object.keys(h));!e||!e.force;){if(p>o)return!1;e=h[p],p++}return"object"==typeof e.hero?z(f,e.hero):e.category?$[e.category][e.hero]:$[e.hero]}return e&&t?t:e&&"object"==typeof e.hero?z(f,e.hero):z(f)}function a(){m&&(clearTimeout(m),m=!1);do if(g=n(),!g)return b(),void(b=oe);while(g.appearConditions&&!_.get(g.appearConditions));if("random"===g.appearanceInfo&&q(g),v=0,w=0,"interact"===g.type)r(g),e.eventManager.notify(e.Events.INTERACT.NEW,g.appearanceInfo),s(g,v);else{if("dialog"!==g.type)return;e.dayTimer.pause(),e.eventManager.notify(e.Events.INTERACT.NEW,g.appearanceInfo),d(g,w),w++}g.stallTime&&(m=setTimeout(function(){var e=g.stallConditions;if(e)for(var t=0;t<e.length;t++)_.set(e[t]);m=!1},g.stallTime))}function r(e){var t=Math.max.apply(this,e.offers);if(X[e.item]){var o=t-X[e.item].jPrice;o>=0&&(I+=t-X[e.item].jPrice,k[e.item]=k[e.item]||0,k[e.item]++)}}function i(){var t=e.playerState.getStockedItems();for(var o in t)k[o]&&(I+=Math.min(k[o],t[o])*(X[o].jPrice-X[o].price));e.analytics.track("game","potentialProfit",I)}function s(t,o,n){var a="string"==typeof t.offerText?t.offerText:t.offerText[o],r=t.offers[o]||0;if("object"==typeof a){for(var i in a)if(_.get(i))return void e.eventManager.notify(e.Events.INTERACT.OFFER,r,t.item,a[i],n);a["default"]?e.eventManager.notify(e.Events.INTERACT.OFFER,r,t.item,a["default"],n):e.eventManager.notify(e.Events.INTERACT.OFFER,r,t.item,"ERROR, NO DIALOG AVAILABLE",n)}else"string"==typeof a&&e.eventManager.notify(e.Events.INTERACT.OFFER,r,t.item,a,n)}function d(t,o){var n=g.dialog instanceof Array?g.dialog[o]:g.dialog;if("object"==typeof n){for(var a in n)if(_.get(a))return void e.eventManager.notify(e.Events.INTERACT.DIALOG,n[a]);n["default"]?e.eventManager.notify(e.Events.INTERACT.DIALOG,n["default"]):e.eventManager.notify(e.Events.INTERACT.DIALOG,"ERROR, NO DIALOG AVAILABLE")}else e.eventManager.notify(e.Events.INTERACT.DIALOG,n)}function l(e,t){return e[t]||e["default"]||"ERROR: NO DIALOG SET"}var u,f,c,h,p,g,m,v,w,b,T,I,k,_=e.conditionManager;this.getCurrentDay=function(){return u},this.startDay=function(t,n,r){e.dayTimer&&e.dayTimer.pause(),c=!1,I=0,k={},u=n,f=t,b=function(){i(),r()},_.init(t.conditions),e.eventManager.notify(e.Events.DAY.START,{clues:t.clues,questions:t.questions}),p=0,o(t),e.dayTimer=new x(function(){y("DAY ENDING TIMER"),c=!0},t.length*T,function(){e.eventManager.notify(e.Events.TIMER.PAUSE,1644825),e.displayManager.imgSun.frame=1,e.displayManager.spawnGoldenCloud=!1},function(){e.eventManager.notify(e.Events.TIMER.RESUME,16777215),e.displayManager.imgSun.frame=0,e.displayManager.spawnGoldenCloud=!0}),a()},t()}function L(e){function t(){a.StockedItems=["sword"],a.Items={sword:5},a.AvailableItems=["sword","chicken","shield","bow"],a.Gold=0,a.Level=1,a.EXP=0,a.numSlots=1,o(),e.eventManager.register(e.Events.LEVEL.ACCEPT,n),e.eventManager.register(e.Events.STOCK.STARTDAY,o)}function o(){r=JSON.parse(JSON.stringify(a))}function n(e){e.indexOf("itemslot")>=0&&a.numSlots++}var a={Items:{},AvailableItems:[],StockedItems:[],Gold:0,Level:0,EXP:0,numSlots:1},r={};this.resetStats=function(){a=JSON.parse(JSON.stringify(r)),e.eventManager.notify(e.Events.UPDATE.GOLD,a.Gold),e.eventManager.notify(e.Events.UPDATE.ITEMS,a.Items),e.eventManager.notify(e.Events.UPDATE.STOCKGOLD,a.Gold)},this.updateItem=function(e,t){a.Items[e]=t},this.decrementItem=function(e){void 0===a.Items[e]||a.Items[e]<=0||a.Items[e]--},this.addsubGold=function(e){a.Gold+=e},this.getGold=function(){return a.Gold},this.getNumSlots=function(){return a.numSlots},this.getItems=function(){return"object"!=typeof a.Items?{}:JSON.parse(JSON.stringify(a.Items))},this.getStockedItems=function(){for(var e={},t=0;t<a.StockedItems.length;t++)e[a.StockedItems[t]]=a.Items[a.StockedItems[t]]||0;return e},this.getAvalItems=function(){return"object"!=typeof a.Items?{}:JSON.parse(JSON.stringify(a.AvailableItems))},this.checkStock=function(e){return X[e]&&a.StockedItems.indexOf(e)>=0&&!(void 0===a.Items[e])&&a.Items[e]>0&&"None"!==e},this.checkPrice=function(e,t){var o=a.Items[e]||!X[e]?0:X[e].jPrice;return a.Gold+t>=o},this.update=function(t,o,n){a.Gold=t,a.Items=JSON.parse(JSON.stringify(o))||{},a.StockedItems=n;for(var r=a.StockedItems[0]||"",i=1;i<a.StockedItems.length;i++)r+="_"+a.StockedItems[i];e.analytics.track("STOCK.COMMIT",r,a.numSlots)},this.updateProfit=function(t){0>=t||(y("ADDING "+t+" TO EXP"),a.EXP+=t,a.EXP>=10*a.Level&&(e.eventManager.notify(e.Events.LEVEL.LEVELUP,a.Level+1),a.EXP=t%=10*a.Level,a.Level++),e.eventManager.notify(e.Events.LEVEL.EXPUP,a.EXP/(10*a.Level)))},t()}function H(e){function t(){f=0,u={sword:5},e.eventManager.register(e.Events.INVENTORY.SOLD,d),e.eventManager.register(e.Events.STOCK.ADD,i),e.eventManager.register(e.Events.STOCK.REMOVE,s),e.eventManager.register(e.Events.STOCK.COMMIT,l),e.eventManager.register(e.Events.STOCK.OUTSTOCK,a),e.eventManager.register(e.Events.STOCK.INIT,o),e.eventManager.register(e.Events.LEVEL.ACCEPT,r),e.eventManager.register(e.Events.STOCK.STARTDAY,n)}function o(){e.eventManager.notify(e.Events.UPDATE.ITEMS,u),e.eventManager.notify(e.Events.UPDATE.STOCKGOLD,e.playerState.getGold()-f)}function n(){e.eventManager.notify(e.Events.STOCK.INIT,e.playerState.getNumSlots(),e.playerState.getGold(),e.playerState.getAvalItems(),e.playerState.getItems())}function a(t){void 0===X[t]&&alert("Trying to remove an item that doesn't exist"),playerItems=e.playerState.getItems();var o=(u[t]||playerItems[t])-(playerItems[t]||0)||0;u[t]=playerItems[t]||0,f-=o*X[t].price,e.eventManager.notify(e.Events.UPDATE.ITEMS,u),e.eventManager.notify(e.Events.UPDATE.STOCKGOLD,e.playerState.getGold()-f)}function r(e){}function i(t,o){void 0===X[t]?alert("Trying to remove an item that doesn't exist"):X[t].price*o+f<=e.playerState.getGold()&&(u[t]=(u[t]||0)+o,f+=X[t].price*o),e.eventManager.notify(e.Events.UPDATE.ITEMS,u),e.eventManager.notify(e.Events.UPDATE.STOCKGOLD,e.playerState.getGold()-f)}function s(t,o){void 0===X[t]?alert("Trying to remove an item that doesn't exist"):void 0===u[t]?alert("Trying to remove an item that we dont have!"):u[t]<o?(alert("Trying to remove too many items!"),u[t]=0):u[t]-o<(e.playerState.getItems()[t]||0)?u[t]=e.playerState.getItems()[t]||0:(u[t]=u[t]-o,f-=X[t].price*o),e.eventManager.notify(e.Events.UPDATE.ITEMS,u),e.eventManager.notify(e.Events.UPDATE.STOCKGOLD,e.playerState.getGold()-f)}function d(t,o){var n=o;if("None"!==t&&"NoneNoXP"!==t){if(void 0===X[t])return-1;var a=e.playerState.getItems(),r=e.playerState.getStockedItems();void 0===a[t]||a[t]<=0||void 0===r[t]?(e.analytics.track("SOLD","jeff_"+t,o),o-=X[t].jPrice,n-=X[t].jPrice,e.eventManager.notify(e.Events.TIMER.JUMP,3e3)):(e.analytics.track("SOLD","stock_"+t,o),n-=X[t].price),e.playerState.decrementItem(t),u=e.playerState.getItems()}e.playerState.addsubGold(o),"NoneNoXP"!==t&&e.playerState.updateProfit(n),e.eventManager.notify(e.Events.UPDATE.GOLD,e.playerState.getGold()),e.eventManager.notify(e.Events.UPDATE.ITEMS,e.playerState.getItems())}function l(t){var o=e.playerState.getGold()-f;f=0,e.playerState.update(o,u,t),e.eventManager.notify(e.Events.UPDATE.GOLD,e.playerState.getGold())}var u,f;this.getGoldSpent=function(){return f},this.resetStock=function(e){u=e,f=0},t()}function F(e){function t(t,o,n){e.playerState.checkStock(o)||"None"===o||(e.dialogManager.printJeff(l(o,X[o].jPrice)),d=o,a())}function o(){e.dialogManager.printJeff(u(d)),r()}function n(){e.dialogManager.printJeff(f(d)),r()}function a(){i(),e.eventManager.register(e.Events.INVENTORY.SOLD,o),e.eventManager.register(e.Events.INVENTORY.NOTSOLD,n)}function r(){i(),e.eventManager.register(e.Events.INTERACT.OFFER,t),e.eventManager.register(e.Events.INTERACT.NEW,s)}function i(){e.eventManager.remove(e.Events.INVENTORY.SOLD,o),e.eventManager.remove(e.Events.INVENTORY.NOTSOLD,n),e.eventManager.remove(e.Events.INTERACT.OFFER,t)}function s(){e.dialogManager.printJeff(""),d=!1,e.eventManager.remove(e.Events.INTERACT.NEW,s)}var d;e.eventManager.register(e.Events.INTERACT.OFFER,t);var l,u,f;!function(){var e=["Hey kiddo, it looks like you're out of [x]s. I'll magic you up one for [y] gold.","You can't sell what you don't have. Lucky for you, I can make you [ax] for [y] gold.","We don't have any [x]s. Want me to magic out one for [y] gold?","Kid, we need to stock up on [x]s. I can make you one right now for [y] gold."];l=function(t,o){t=t||"ERROR",o=m(o)||"ERROR";var n=v(t),a=Math.floor(Math.random()*e.length),r=e[a],i="string"==typeof o?o.charAt(0).toUpperCase()+o.slice(1):o;return r.replace("[x]",t).replace("[y]",o).replace("[Y]",i).replace("[ax]",n)}}(),function(){var e={sword:["Extra pointy sword, coming right up!","Here comes a sword, everyone stand clear!"],chicken:["Mmmmm, smells nice.","Delicious precooked chicken, coming right up!"],bow:["Alrighty, here comes a bow!","Extra springy bow, coming right up!"],"default":["URRRRRRGH@@, item making isn't easy.","Alright, fresh hot items, coming right up.","Thanks for the cash kid, I'll have the item ready in no time.","Don't watch me while I make it. I get nervous."]};u=function(t){t=t||"ERROR";var o=e[t]?e[t].concat(e["default"]):e["default"],n=Math.floor(Math.random()*o.length);return o[n]}}(),function(){var e={sword:["Darn. I really like making swords.","Oh well, we'll get the next one."],chicken:["I'll just make myself a chicken to eat. @@@@Well, at least I would if I had a mouth."],bow:["But bows are so funnnnnn. Fine."],"default":["Come on, I don't get to show off my magic powers? So disappointing.","Just so you know, I could have made that item if I wanted to.","Too poor to spring for it? Oh well."]};f=function(t){t=t||"ERROR";var o=e[t]?e[t].concat(e["default"]):e["default"],n=Math.floor(Math.random()*o.length);return o[n]}}()}function U(e){function t(){a>=r.length?(e.eventManager.remove(e.Events.WRAPUP.NEXT,t),o()):(e.eventManager.notify(e.Events.WRAPUP.MESSAGE,r[a]),a++)}function o(){s&&(s=!1,e.playerState.addsubGold(i),i=0,r=[],a=0,e.eventManager.notify(e.Events.UPDATE.GOLD,e.playerState.getGold()),n())}var n,a=0,r=[],i=0;this.startDay=function(o,a){n=a||function(){};for(var d=0;d<o.wrapup.length;d++){var l=o.wrapup[d];if(l.conditions){for(var u=!1,f=0;f<l.conditions.length;f++)if(!e.conditionManager.get(l.conditions[f])){u=!0;break}if(u)continue}l.gold&&(i+=l.gold);for(var c=l.text instanceof Array?l.text:[l.text],f=0;f<c.length;f++)r.push(c[f])}s=!0,e.eventManager.register(e.Events.WRAPUP.NEXT,t),e.eventManager.notify(e.Events.WRAPUP.START)};var s=!1}function j(e){e.reset=new d,e.conditionManager=new O(e),e.eventManager=new l(e),e.analytics?e.analytics.setRunID():e.analytics=new u,S(e),N(e),e.interactionManager=new R(e),e.questionManager=new M(e),e.dialogManager=new D(e),e.playerState=new L(e),e.wrapupManager=new U(e),e.stock=new H(e),e.jeff=new F(e),e.endingScreen=new a(e),e.stockUI=new s(e),e.endState=new n(e)}function W(e){var t=0,o=V(t);e.timesFailed=0,e.timesWon=0,t>0&&debugGame&&debugGame.eventManager.notify(debugGame.Events.TUTORIAL.BEGIN),e.analytics.set("dimension1",t),e.analytics.track("day","begin"+t,t),e.eventManager.register(e.Events.UPDATE.GOLD,function(o){0>o&&(e.timesFailed++,e.analytics.set("dimension4",e.timesFailed),e.analytics.track("game","fail",t),e.endStateWrapper.setGameResult(!1),e.endState.endState())});var n=function(){e.stockUI.startDay(o.clues.crisis,function(){a(o)})},a=function(){e.eventManager.notify(e.Events.WRAPUP.END),e.interactionManager.startDay(o,t,function(){e.eventManager.notify(e.Events.DAY.END),r()})},r=function(){e.wrapupManager.startDay(o,function(){e.eventManager.notify(e.Events.WRAPUP.END),t++,e.analytics.set("dimension1",t),e.analytics.track("day","begin"+t,t),7>=t?(o=V(t),n()):(e.timesWon++,e.analytics.set("dimension4",e.timesWon),e.endStateWrapper.setGameResult(!0),e.endState.endState())})};debugGame&&(window.forceStock=n),e.restartDay=function(){0===t?a():n()},a()}var Y={DEBUG_MODE:!0,RESOLUTION:[800,600]};document.addEventListener("DOMContentLoaded",function(){document.getElementById("gameDiv").addEventListener("contextmenu",function(e){e.preventDefault()},!1);var a=new Phaser.Game(Y.RESOLUTION[0],Y.RESOLUTION[1],Phaser.AUTO,"gameDiv");Y.DEBUG_MODE?window.debugGame=a:window.debugGame=!1,a.loadStateWrapper=new e(a),a.startStateWrapper=new t(a),a.playStateWrapper=new o(a),a.endStateWrapper=new n(a),a.state.add("state_load",a.loadStateWrapper.loadState),a.state.add("state_start",a.startStateWrapper.startState),a.state.add("state_play",a.playStateWrapper.playState),a.state.start("state_load")});var z,q,B,J,V,K={PassiveLighter:"#ffffca",PassiveLight:"#af9165",PassiveMain:"#4d372c",PassiveDark:"#4d372c",PassiveDarker:"#4d361e",PassiveDarkest:"#2e2821",ActiveLight:"#cfcece",ActiveMain:"#acacac",ActiveDark:"#575757",AccentAccept:"#92cb9a",AccentReject:"#cb929a",Background:"#92cb9a",SkyDawnPrimary:"#92cb9a",SkyDawnSecondary:"#a4dbb6"},Q={dawn:{start:0,end:.2},noon:{start:.15,end:.6},afternoon:{start:.4,end:.9},dusk:{start:.75,end:1}},X={sword:{price:5,jPrice:7},chicken:{price:3,jPrice:5},bow:{price:4,jPrice:6},water:{price:2,jPrice:3},meat:{price:3,jPrice:5},shield:{price:6,jPrice:8},staff:{price:8,jPrice:11},bone_sword:{price:12,jPrice:15}},Z={tutorialWoman:"face|2,body|2,hair|2,eye|5,nose|11,mouth|3,misc|1,skin|(259.58,198.19,158.71)",scaredMan:"face|5,misc|6,body|3,hair|2,eye|2,nose|8,mouth|2,skin|(259.58,198.19,158.71)",tracker:"face|1,misc|6,body|5,hair|8,eye|3,nose|11,mouth|6,skin|(259.58,198.19,158.71)"},$={dayOne:{introJeff:{type:"dialog",appearanceInfo:"jeff",dialog:["Hey kiddo, I'm Jeff the Magic Anvil!@@/Just accept it. We don't have time for questions.","It looks like you've got five swords there to sell./The going rate for those is five gold a piece.","Let's see how you do selling them!/Don't worry kid, I'll be right here if you need me."]},messUpJeff:{type:"dialog",appearanceInfo:"jeff",dialog:["Kid, you might want to keep a closer eye on what they're offering.","Remember, those swords cost you five gold each."],appearConditions:["jeffReminder"]},tutorialWoman:{type:"dialog",appearanceInfo:Z.tutorialWoman,dialog:["I don't have much time. My cousin's on his way. He wants a sword./@@Please don't sell him one.","I wrote clues to help you find him./If you turn him away, I'll make sure you're paid."],finishConditions:["tutorialBegin"]},tutorialWomanHappy:{type:"dialog",appearanceInfo:Z.tutorialWoman,appearConditions:["refuseCousin"],dialog:"Thank you so much. Here's a little something for the help.",endMoney:7},tutorialWomanAngry:{type:"dialog",appearanceInfo:Z.tutorialWoman,appearConditions:["soldCousin"],dialog:"I can't believe you sold to my cousin. Did you even bother asking about his favorite color?"},badCousin:{type:"interact",item:"sword",appearanceInfo:"random",offers:[10],offerText:"Give me a sword and you can have ten gold instead of a mouth full of teeth.",success:"Heh, thanks.",fail:"I'll be back.",questions:{color:"Mac and Cheese.","default":"I don't care."},items:{"default":"I don't care."},profiles:{"default":"I don't care."},sellConditions:["soldCousin"],refuseConditions:["refuseCousin"],isFalseHero:!0},chickenJeff:{type:"dialog",appearanceInfo:"jeff",dialog:["Oh, I forgot to mention. I can make you anything that the people want and you don't have, for a price.","YOUR@ S@O@U@L@@/But for you kid, I'll also accept gold pieces.","If I see that you're out of what the customer wants, I'll be sure to shout my price at you.",{soldChicken:"You're pretty lucky to have me, kid. @@Not many anvils can magic up a cooked chicken.","default":"You might want to try haggling and selling more next time."}]},endOfTutorialJeff:{type:"dialog",appearanceInfo:"jeff",dialog:["Nicely done, kid. We're still in business!/. . . Against all odds.",{soldCousin:"We need to keep a closer eye out for who to sell to./I have an idea on how to fix that.","default":"We got lucky to get that tip about the cousin./I'll make sure we don't have to rely on luck again."},"I'll research who we should and shouldn't sell to, and put it in that notebook.","Now let's get some sleep. We've got a long day ahead of us."]}},dayTwo:{introJeff:{type:"dialog",appearanceInfo:"jeff",dialog:["Alright kiddo, time for another exciting day of shopkeeping.","Don't forget to check out your notebook. While you were resting your weak organic body, I was doing some research.","I read about a hero who was destined to save this town. You'd better make sure they get what they need."]},rhymeMan:{type:"interact",item:"sword",appearanceInfo:"random",offers:[4],offerText:"Hello shopkeeper, I hope you're not bored./For four gold, I would like to buy a sword!",success:"Thank you sir!/Were I a cat, I would purr!",fail:"I do not have the cash,/my apologies for being brash!",questions:{color:"Though it may fill some with dread,/I must say, my favorite color is red!",day:"My day has been fun, not too short not too long./If this takes much longer, I may break out in song!","default":"Of that, I have not been taught,/and thus I sadly know naught."},items:{sword:"Swords are great for stabbing./Note: they are not meant for grabbing!","default":"I do not know what to make of that,/but I am glad to have had this chat!"},profiles:{goblin:"Ah, my mortal enemy is that./I wish to engage one in single combat.","default":"What a face, what a smile!/And what dashing style!"},sellConditions:["soldHero"],refuseConditions:["refusedHero"],isHero:!0},badRhymeMan:{type:"interact",item:"sword",appearanceInfo:"random",offers:[2],offerText:"Ahoy there friend, this is a good month./I'd like a sword for two gold please./@Urm, @@@dunth?",success:"Thank you my friend!",fail:"Fine, I'll go elsewhere.",questions:{color:"Though I love many colors, my favorite is orange./It's the greatest of colors, because it's so . . . @@@@florange?",day:"Good.","default":"What?"},items:{sword:"Swords are the best, I need one. @@@@Um.@@@@@/Rhyming is hard, and I've run out of rhymes.","default":"Erm, @@cool?"},profiles:{goblin:"Eek! Get it away, get it away!","default":"Yup, that's a person?"},sellConditions:["soldFalse"],refuseConditions:["refusedFalse"],isFalseHero:!0},endJeff:{type:"dialog",appearanceInfo:"jeff",dialog:[{soldHero:"Nice work, kid. Glad you read my instructions.","default":"Well, we made it. Wish you had read my instructions though."},{dayOneRobbery:"Hope we don't get robbed again. Haven't felt right since Mr. Mac and Cheese tried to steal me.","default":"Let's hope our streak of good luck continues."}]}},dayThree:{introJeff:{type:"dialog",appearanceInfo:"jeff",dialog:["Alright kiddo, third day's the charm. Let's do this.","Remember, if you're not sure if someone's the hero, you might want to question them or look at them closely."]},endJeff:{type:"dialog",appearanceInfo:"jeff",dialog:[{soldHero:"Nice work, kid. Let's get some sleep.","default":"We made it, kiddo. Let's hope we don't get robbed."}]},startDog:{type:"dialog",appearanceInfo:"dog",dialog:["*Arf!* @*Arf!*"]},jeffDog:{type:"dialog",appearanceInfo:"jeff",dialog:["Oh my gosh, can we keep it, can we keep it?","Please please please please please please please please please."]},dogChoice:{type:"interact",item:"chicken",appearanceInfo:"dog",offers:[0],offerText:"*Arf!*@@/(It looks like the dog will want a free chicken in exchange for staying.)",success:"*Arf!*",fail:"*Arf.*",questions:{"default":"*Arf!*"},items:{"default":"*Arf!*"},profiles:{"default":"*Arf!*"},sellConditions:["gotDog"],refuseConditions:["lostDog"]},jeffHappy:{type:"dialog",appearanceInfo:"jeff",dialog:[{gotDog:"YES, this is the best day. Dogs are one of the few things I can't create.","default":"This is the worst day ever."},{gotDog:"Well, I can,@@@ but I can only make dead ones.","default":"I am irate."}]}},randomGenHero:{},jeffPoolStart:{genericJeff:{type:"dialog",appearanceInfo:"jeff",dialog:["Alright kiddo, time for another fun filled day. Let's do this.","Also, just so you know, sort of in beta, so no promises it won't break."]}},jeffPoolEnd:{endJeff:{type:"dialog",appearanceInfo:"jeff",dialog:["Hey kid, it's getting late. I think it's time to get some sleep."]}},finalDay:{introJeff:{type:"dialog",appearanceInfo:"jeff",dialog:["Hey kiddo, time for another beautiful day./Doesn't something about today seem diff~~"]},introZoran:{type:"dialog",appearanceInfo:"king_zoran",dialog:["Hello humble shopkeeper. I am your glorious ruler, King Zoran.","I've heard good things about you and your shop./I have an opportunity for you.","If you have 100 gold by the end of this day, I will make you the official royal shopkeeper, up in the castle.","Good luck."]},endZoran:{type:"dialog",appearanceInfo:"king_zoran",dialog:[{gold_100:"Well done, shopkeeper./You have proven yourself worthy.","default":"I am disappointed, shopkeeper. I expected more."},{gold_100:"Come with me, my friend. Let us go to the palace.","default":"Feel free to restart the game and try again. I will be here."}]}},vocabMan:{hero:{type:"interact",item:"bow",appearanceInfo:"random",offers:[2],offerText:"Get @bow,@@ two @gold?",success:"Two gold, @bow get!",fail:"Two gold bow . . .",questions:{color:"@@Gold!",number:"@@Two!","default":". . ."},items:{bow:"Bow!","default":". . ."},profiles:{convict:"Bow get!","default":". . ."},sellConditions:["soldHero"],refuseConditions:["refusedHero"],isHero:!0},villain:{type:"interact",item:"bow",appearanceInfo:"random",offers:[3],offerText:"Three gold, bow get?",success:"Thanks!",fail:"Ugh, fine.",questions:{color:"Red!",number:"Four!","default":"Huh?"},items:{bow:"Nice!","default":"Huh?"},profiles:{convict:". . .","default":". . ."},isFalseHero:!0}},stutterMan:{hero:{type:"interact",item:"shield",appearanceInfo:"random",offers:[4,1],offerText:["I would like a brand new sssshiny sssshield. Four gold?","Comon good sssssir. How about one gold? Thatssss more than four!"],success:"YESSSSSSSSSSSSSSS...",fail:"Lookssss like I will just head to the pub with my gold ...",questions:{numbers:"Ummmmmm ... Maybe Ten and two fifthsssss?",animal:"You ssssay it like they're niccccce. I aint afraid of no ssssnakesss. Exccccept on planesss ...","default":". . ."},items:{shiled:"Sssssshiny!","default":". . ."},profiles:{convict:"Poopoo fart I should not be here","default":". . ."},sellConditions:["soldHero"],refuseConditions:["refusedHero"],isHero:!0},villain1:{type:"interact",item:"shield",appearanceInfo:"random",offers:[2],offerText:"Whats it take to get a nice ssshiny sssshield? Two gold?",success:"That was easy! HAHA! I am no hero!",fail:"How did you know? I stuttered and everything ...",questions:{numbers:"Four of course! Everyone knowssss that!",animal:"Snakes? .@.@.@ I mean sssssnakes are bad","default":"Huh?"},items:{shield:"That is what I want. Yessss","default":"Huh?"},profiles:{convict:". . .","default":". . ."},isFalseHero:!0},villain2:{type:"interact",item:"shield",appearanceInfo:"random",offers:[3,4],offerText:["I know how to bash! Ssssshields are great for that. Three gold?","Okay, four gold. Four issss more than three!"],success:"Snakes. @Planes. @Snow. @@Pepperoni. @I can say it all you fool!",fail:"Maybe im not caught up for the acting business. I'm better at smashing ...",questions:{numbers:"Four. Like two lesss than sssix!",animal:"I can ssssmash ssssnakesss with a sssshiled. Gimmie, gimmie!","default":"Huh?"},items:{shield:"That is what I want. Yessss","default":"Huh?"},profiles:{convict:". . .","default":". . ."},isFalseHero:!0},villain3:{type:"interact",item:"shield",appearanceInfo:"random",offers:[1],offerText:"One gold for shield?",success:"Why thank you. What a good deal for an honest, not sneaky, person like myself.",fail:"I thought if I talked less you would believe me",questions:{numbers:"Ten. Like three lesss than sssix!",animal:"Snakes. Yeah ...","default":"Huh?"},items:{shield:"That is what I want.","default":"Huh?"},profiles:{convict:". . .","default":". . ."},isFalseHero:!0}},rhymeAdvance:{hero:{type:"interact",item:"shield",appearanceInfo:"random",offers:[2],offerText:["You, friendly shopkeeper. Your heart is true? I need a shield for two./. . . gold."],success:"Thank you my friend, that gold I am happy to spend.",fail:"Very well friend, I hope this is not the end.",questions:{day:"Very normal, not too exciting.",color:"Orange brown","default":". . ."},sellConditions:["soldHero"],refuseConditions:["refusedHero"],isHero:!0},falseHero1:{type:"interact",item:"shield",appearanceInfo:"random",offers:[2],offerText:["You, friendly shopkeeper. Your heart is true? I need a shield for the gold of two."],success:"Heh, thanks.",fail:"Fine.",questions:{day:"It was fine.",color:"Navy.","default":". . ."},isFalseHero:!0},falseHero2:{type:"interact",item:"shield",appearanceInfo:"random",offers:[3],offerText:["Why shopkeeper, you seem a nice guy. A shield I need for three gold."],success:"Heh, thanks.",fail:"Fine.",questions:{day:"Nothing out of the ordinary.",color:"Chartreuse.","default":". . ."},sellConditions:["soldHero"],refuseConditions:["refusedHero"],isFalseHero:!0},falseHero3:{type:"interact",item:"shield",appearanceInfo:"random",offers:[3],
offerText:["You, shopkeeper. Your heart is true? . . . I need a shield for three gold."],success:"Heh, thanks.",fail:"Fine.",questions:{day:"Not too bad.",color:"Purple blue","default":". . ."},sellConditions:["soldHero"],refuseConditions:["refusedHero"]}},stallingMan:{hero:{type:"interact",item:"sword",appearanceInfo:"random",offers:[0],offerText:"I need a @@@pointy thing to @@@protect the town! @@@I have no @@@money can I @@@have for free?",success:"This supercallfraglisticous pointy @@@thing will do @@@wonderfully",fail:"I guess I'll @@@find another pointy @@@thing to fight @@@with!",questions:{sword:"What is that? @@@It's pointy, that @@@will do.","super":"... supercallilictousesness ... supercallfraglisticous? ... Thats my new @@@word!","default":". . ."},items:{sword:"Oooooh pointy","default":". . ."},profiles:{convict:"Poopoo fart I should not be here","default":". . ."},sellConditions:["soldHero"],refuseConditions:["refusedHero"],isHero:!0},villain1:{type:"interact",item:"sword",appearanceInfo:"random",offers:[0,0],offerText:["I'm the hero. @@@I'll take a free @@@sword, please.","Seriously though. I @@@am the hero. @@@free sword!"],success:"Sucka! I knew that would work.",fail:"Can't blame me for trying right?",questions:{sword:"That's what I @@@want!","super":"Supercalifragilisticexpialidocious. From the @@@movies!","default":"Huh?"},items:{sword:"That is what I want. Yessss","default":"Huh?"},profiles:{convict:". . .","default":". . ."},isFalseHero:!0},villain2:{type:"interact",item:"sword",appearanceInfo:"random",offers:[0],offerText:"I'll take a pointy thing for free please",success:"I'll send a couple of my friends here to get free swords too!",fail:"I'll be off then ...",questions:{sword:"That is a pointy thing!","super":"I don't even know what you just said","default":"Huh?"},items:{shield:"That is what I want. Yessss","default":"Huh?"},profiles:{convict:". . .","default":". . ."},isFalseHero:!0}},urchin:{"1scaredMan":{type:"interact",item:"None",appearanceInfo:Z.scaredMan,offers:[0],offerText:"I need to hide here. He's after me./Please, @@he'll kill me if he finds me.",success:"Thank you.",fail:"Oh no.",questions:{day:"Very, @@very@ bad.",color:"I don't know.","default":"Please,@@ I don't have much time."},sellConditions:["urchin_hidMan"],refuseConditions:["urchin_manRefused"]},"1trackerSearch":{type:"interact",item:"None",appearanceInfo:Z.tracker,offers:[10,15],offerText:["A very dangerous man is loose and I need to find him./I'll pay you ten gold for any information.","What if I offered you fifteen?"],success:"Well, well street urchin. You're coming with me.",fail:"Very well,@@ I hope you've been honest with me./@@@@For your sake.",questions:{day:"Busy.",color:"Whatever will make you move faster.","default":"Stop wasting my time."},appearConditions:["urchin_hidMan"],sellConditions:["urchin_manDead"],refuseConditions:["urchin_manLived"]},"1trackerWarn":{type:"dialog",appearanceInfo:Z.tracker,dialog:["A very dangerous man is loose and I need to find him./If you see anyone suspicious, do not trust them."],appearConditions:["urchin_manRefused"]},"2gratefulMan":{type:"interact",item:"None",appearanceInfo:Z.scaredMan,offers:[10],offerText:["Thank you so much for hiding me. Would you accept this gift?"],success:"Use it well friend. Be wary of the tracker.",fail:". . .",questions:{},appearConditions:["urchin_manGrateful"],sellConditions:["urchin_acceptedGift"],refuseConditions:["urchin_refusedGift"]},"2angryFamily":{type:"dialog",appearanceInfo:"random",dialog:["We know you sold out our brother to that man.","Watch your back, coward."],appearConditions:["urchin_familyAngry"]},"4tracker":{type:"interact",item:"None",appearanceInfo:Z.tracker,offers:[-10],offerText:["Did you hide the dangerous man from me a few days ago?/@@I just want the truth."],success:". . . I'll be back.",fail:". . .",questions:{"default":". . ."},appearConditions:["urchin_trackerSuspicious"],sellConditions:["urchin_trackerTruth"],refuseConditions:["urchin_trackerLied"]},"4waryMan":{type:"dialog",appearanceInfo:Z.scaredMan,dialog:["I don't quite know what to make of you, shopkeeper.","Tomorrow, I will be back, and will try to buy a sword for two gold.","If you remember my face, I would be grateful."],appearConditions:["urchin_manWary"]},"4trackerWarning":{type:"interact",item:"None",appearanceInfo:Z.tracker,offers:[-7],offerText:["By helping me capture that man, you've made dangerous enemies. I'll protect you for seven gold."],success:"Very good, I will return in the night.",fail:"Very well. Good luck, you will need it.",questions:{"default":". . ."},appearConditions:["urchin_familyAngry"],sellConditions:["urchin_trackerProtect"],refuseConditions:["urchin_unprotected"]},"5waryManTest":{type:"interact",item:"sword",appearanceInfo:Z.scaredMan,offers:[2],offerText:["Hiya! Can I get a sword for two gold?"],success:"Well done, shopkeeper.",fail:"Hrm . . .",questions:{"default":". . ."},appearConditions:["urchin_manWary"],sellConditions:["urchin_manSold"]},"5madTracker":{type:"interact",item:"None",appearanceInfo:Z.tracker,offers:[-10],offerText:["I got to thinking, shopkeeper. If you lied to me about the man, I want my ten gold back."],success:"Good choice.",fail:". . .",questions:{"default":"Stop wasting my time and answer!"},appearConditions:["urchin_trackerMad"],sellConditions:["urchin_trackerBribed"],refuseConditions:["urchin_trackerRefused"]},"6proudMan":{type:"dialog",appearanceInfo:Z.scaredMan,dialog:["You seem like the good sort of person after all.","Please shopkeeper, accept this gift."],appearConditions:["urchin_manProud"],endMoney:15},"6vengefulTracker":{type:"dialog",appearanceInfo:Z.tracker,dialog:[". . .","* The Tracker punches you in the stomach and takes 15 gold from your register. *",". . ."],appearConditions:["urchin_trackerVengeful"],endMoney:-15}},treasure:{"2offer":{type:"interact",item:"None",appearanceInfo:"treasure_hunter",offers:[-5],offerText:["Hey shopkeep, in my travels I found this treasure map./Want it? Five gold."],success:"Hope it's worth it!@@/I mean, of course it's worth it!",fail:"Your loss, shopkeep.",questions:{"default":". . ."},sellConditions:["treasure_bought"],refuseConditions:["treasure_refused"]},"3friendlyOffer":{type:"interact",item:"None",appearanceInfo:"treasure_hunter",offers:[-10],offerText:["Hey shopkeep, good to see you again! How about another map? Ten gold this time."],success:"Have fun, pal.",fail:"We'll see if you change your mind tomorrow.",questions:{"default":". . ."},appearConditions:["treasure_happy"],sellConditions:["treasure_bought"],refuseConditions:["treasure_refused"]},"3sadOffer":{type:"interact",item:"None",appearanceInfo:"treasure_hunter",offers:[-10],offerText:["Hey shopkeep, this time I have an even better map. Want it for ten gold?"],success:"Have fun, pal.",fail:"We'll see if you change your mind tomorrow.",questions:{"default":". . ."},appearConditions:["treasure_sad"],sellConditions:["treasure_bought"],refuseConditions:["treasure_refused"]},"4dungeonOffer":{type:"interact",item:"None",appearanceInfo:"treasure_hunter",offers:[-15],offerText:["Howdy shopkeep, I'm going to explore a dungeon. Want to invest and split the keep? Give me fifteen gold."],success:"Wish me luck, pal.",fail:"Alright, I'll try to find the cash elsewhere.",questions:{"default":". . ."},appearConditions:["treasure_hunting"],sellConditions:["treasure_invested"],refuseConditions:["treasure_refused"]},"4lastMap":{type:"interact",item:"None",appearanceInfo:"treasure_hunter",offers:[-15],offerText:["Hey shopkeep, I've got one last map for you. It'll be fifteen gold."],success:"Happy travels, shopkeep.",fail:"Alrighty shopkeep, have it your way.",questions:{"default":". . ."},appearConditions:["treasure_sad"],sellConditions:["treasure_bought"],refuseConditions:["treasure_refused"]},"6goodbye":{type:"dialog",appearanceInfo:"treasure_hunter",dialog:["Hey shopkeep, I escaped that dungeon by the skin of my teeth!","As promised, here's the return on your investment. Spend it well, friend."],appearConditions:["treasure_hunting2"],endMoney:30}},artifact:{"1initialGive":{type:"dialog",appearanceInfo:"artifact",dialog:["Hey, hold onto this orb for me. I'll pay you 50 gold if you hold onto it for 5 days.","* The man gives you a black orb. It pulses with unnatural energy. *"]},"2shinyOffer":{type:"interact",item:"None",appearanceInfo:"random",offers:[10],offerText:["Ooh, that orb is beautiful. Think I could take it off your hands for ten gold?"],success:"Thanks, appreciate it.",fail:"Oh well, it was a long shot anyway.",questions:{"default":". . ."},sellConditions:["artifact_soldOrb"],refuseConditions:["artifact_keptOrb"]},"3studyOffer":{type:"interact",item:"None",appearanceInfo:"random",offers:[20],offerText:["That orb has a fascinating color. Do you think I could buy it from you for 20 gold?"],success:"Thank you, I cannot wait to study this.",fail:"Well, darn.",questions:{"default":". . ."},appearConditions:["artifact_haveOrb2"],sellConditions:["artifact_soldOrb"],refuseConditions:["artifact_keptOrb"]},"4collectorOffer":{type:"interact",item:"None",appearanceInfo:"random",offers:[40],offerText:["Oh, my. That orb would look fantastic on my mantle. Would you part with it for 40 gold?"],success:"Well isn't this my lucky day.",fail:"Oh dearie me . . .",questions:{"default":". . ."},appearConditions:["artifact_haveOrb3"],sellConditions:["artifact_soldOrb"],refuseConditions:["artifact_keptOrb"]},"5villainOffer":{type:"interact",item:"None",appearanceInfo:"random",offers:[60],offerText:["With that orb, unlimited power could be mine! GIVE IT TO ME. Sixty gold."],success:"AHAHAHAHAHAHA",fail:". . .",questions:{"default":". . ."},appearConditions:["artifact_haveOrb4"],sellConditions:["artifact_soldOrb"],refuseConditions:["artifact_keptOrb"]},"6returnHappy":{type:"dialog",appearanceInfo:"artifact",dialog:["Thank you for holding onto that for me, child."],appearConditions:["haveOrb5"],endMoney:50},"6returnSad":{type:"dialog",appearanceInfo:"artifact",dialog:["You didn't keep the orb? Curse you, child."],appearConditions:["artifact_lostOrb"]},"6returnScared":{type:"dialog",appearanceInfo:"artifact",dialog:["Oh dear child, you sold my orb to that lunatic?","You are a fool."],appearConditions:["artifact_villainOrb"]}},uprising:{"2intro":{type:"dialog",appearanceInfo:"cloak",dialog:["We must rise up and topple those who would exploit us.","If you are with us, accept my third offer tomorrow. It will be one gold.","We are the night."]},"3return":{type:"interact",item:"sword",appearanceInfo:"cloak",offers:[2,3,1],offerText:["Hello friend who I have never seen before. Two gold for a sword?","How about three?","Or one?"],success:"We are the night.",fail:". . . very well.",questions:{"default":". . ."},sellConditions:["uprising_rebel"],refuseConditions:["uprising_citizen"]},"4policeIntro":{type:"dialog",appearanceInfo:"guardian",dialog:["We've heard of some dangerous characters starting up a rebellion against the glorious King Zoran.","If you hear anything, let me know. I will be back soon."]},"4rebelMoney":{type:"interact",item:"None",appearanceInfo:"cloak",offers:[-7],offerText:["Hello friend. The rebellion needs seven gold to continue freeing the people. Will you be one with us?"],success:"We are the night.",fail:". . . very well.",questions:{"default":". . ."},appearConditions:["uprising_rebelBegin"],sellConditions:["uprising_rebel"],refuseConditions:["uprising_citizen"]},"5rebelWarning":{type:"dialog",appearanceInfo:"cloak",dialog:["Hello friend. Thank you for listening to us even if you didn't join.","You should probably think about staying out of the town square today.",". . . Just so you know. No reason at all, nothing to worry about./@@k thanx bye."],appearConditions:["uprising_citizenBegin"]},"5rebelJob":{type:"dialog",appearanceInfo:"cloak",dialog:["Hello friend, I have your mission.","A city official will be here soon to buy a bow for one gold.","Stall him for five seconds before you reject him so we can kidna . . . talk to him."],appearConditions:["uprising_rebelJoined"]},"5official":{type:"interact",item:"bow",appearanceInfo:"random",offers:[1],offerText:["I am an official representative of the city, and I demand a bow for one gold."],success:"You made the right choice",fail:"Your king will hear of this.",questions:{"default":". . ."},stallTime:4e3,appearConditions:["uprising_rebelJoined"],stallConditions:["uprising_officialStalled"]},"5policeAsk":{type:"interact",item:"None",appearanceInfo:"guardian",offers:[0,5],offerText:["Can you tell me anything about the rebels?","What if I offer you five gold?"],success:"Thank you, this will help us greatly.",fail:"Very well, I hope you've been honest. We could make your life very difficult.",questions:{"default":". . ."},sellConditions:["uprising_informant"],refuseConditions:["uprising_traitor"]},"5stallThanks":{type:"dialog",appearanceInfo:"cloak",dialog:["Hello friend, thank you for the help. Now we pay you."],appearConditions:["uprising_officialStalled"],endMoney:17},"6stallAsk":{type:"dialog",appearanceInfo:"guardian",dialog:["Hello citizen, we've heard that one of the rebels will make contact with you today.","Stall her for seven seconds when she's here, and we'll make it worth your while."],appearConditions:["uprising_informantHelper"]},"6rebelStall":{type:"interact",item:"None",appearanceInfo:"cloak",offers:[0],offerText:["Hello friend, this is last time I come here. You are sure you will not join?"],success:"Fantastic! We will see you soon.",fail:"All right, friend. I will see you around then.",questions:{"default":". . ."},stallTime:6e3,appearConditions:["uprising_informantHelper"],stallConditions:["uprising_informant"]},"6policeBribe":{type:"dialog",appearanceInfo:"guardian",dialog:["We know you are lying. You're lucky I'm only taking your gold and not your head."],appearConditions:["uprising_traitorFound"],endMoney:-15}}},ee=[["shop"],["itemslot"],["shop","time"],["itemslot","time"],["shop","time"],["itemslot","time"]],te={shop:[{name:"stone",description:"A rock doesn't look very good ... But at least people know it's a shop.",effect:"Increased chance of counter offer",position:[470,308]},{name:"wooden_desk",description:"Finally it matches your dialog box... desks are great!",effect:"Increased chance of counter offer",position:[481,305]},{name:"wooden",description:"You moved your sign for all to see. Coolio!",effect:"Increased chance of counter offer",position:[481,252]},{name:"wooden_plus",description:"Might as well show off some of the goods!",effect:"Increased chance of counter offer",position:[481,252]}],jeff:[{}],itemslot:[{name:"item_slot",description:"Grow some muscles. You can carry more items than that!",effect:"Additional item slot for stocking",position:[0,0]}],time:[{name:"time",description:"The moon has nothing on you. Bring on the heat!",effect:"More time to sell during the day",position:[0,0]}],stock:[]},oe=function(){}}();